#include "usystem.h"

uSystem::uSystem(QObject *parent)
    : QThread{parent}
{
    color = cv::Scalar(0, 0, 255);

    detect_count = 10;
    mode = detection;

    QDateTime time = QDateTime::currentDateTime();
    datetime_str = time.toString("dd_MM_yy_hh_mm_ss");

    obj_count = -1;

    finished = true;
    system_running = false;

    idx = 0;
}

frameset framesInput;
depth_frame DepthFrame(framesInput);

void uSystem::systemDetectRegister(cv::Mat img, rs2::depth_frame frame, std::string model_path, rs2_intrinsics intrinsics_param, std::vector<cv::Point> points, QString system_dir){
    imgInput = img;
    DepthFrame = frame;
    path = model_path;
    intr = intrinsics_param;
    limit_points = points;
    system_path = system_dir;
    system_running = true;

    if(finished){
        if (detect_model.ReadModel(net, path, true)) {
            qDebug() << "Read net successfully";
        } else{
            emit loadNetError();
            return;
        }
        finished = false;
    }
}

void uSystem::systemCalibrationRegister(CalibrationMatrix calibration_param){
    calib = calibration_param;
}

void uSystem::systemRobotRegister(DH_table table){
    DH = table;
}

void uSystem::getDetectResult(OutputSeg &output){
    output = result[0];
}

void uSystem::getPoseEstimateResult(double &x, double &y, double &z, double &rx, double &ry, double &rz){
    x = sys_x;
    y = sys_y;
    z = sys_z;
    rx = sys_Rx;
    ry = sys_Ry;
    rz = sys_Rz;
}

QVector<double> uSystem::getApproachingPoint(){
    return approaching_point;
}

void uSystem::getImageDetected(cv::Mat &outputImg){
    outputImg = cv::imread(system_path.toStdString() + "/" + "result.jpg");
}

void uSystem::errorEvaluate(double x, double y, double z, double rx, double ry, double rz, double &er_x, double &er_y, double &er_z, double &er_ry, int level){
    if(level == 1){
        // Nerual network
        double H1 = tanh(0.5*(-0.00118599768985891*x + -0.00284233558556287*y + 0.0022533408189105*z + 0.00787943762178147*rx + 0.0160522184469268*ry + -0.000927970121966912*rz + -1.33704210486256));
        double H2 = tanh(0.5*(0.233031149489867*x + 0.00256215505773714*y + -0.013228452772722*z + 0.0353810900509666*rx + 0.0312296116233987*ry + 0.220757570509245*rz + -5.29851687273498));
        double H3 = tanh(0.5*(0.00038477393862275*x + -0.00013021437692485*y + -0.0000759070378577655*z + -0.000104030731495032*rx + -0.00138203346864832*ry + 0.000829885791799275*rz + -1.18674365246642));
        double H4 = tanh(0.5*(0.00129765702398285*x + -0.00443312204919679*y + 0.00149424639548825*z + 0.0170585852074432*rx + -0.0089548638296147*ry + 0.0294146319185704*rz + -0.801155453019809));
        double H5 = tanh(0.5*(0.000573110832988272*x + -0.00016632106971727*y + -0.000157270817529047*z + 0.000359861408606374*rx + 0.00198928325926166*ry + -0.00240213529595963*rz + 1.49471161868694));
        double HH1 = tanh(0.5*(0.634013040647047*H1 + -29.9831323173303*H2 + -8.88539989729213*H3 + 31.4540246283845*H4 + 3.80234807379019*H5 + -6.47080463032892));
        double HH2 = tanh(0.5*(0.197011142922097*H1 + -1.23277646638897*H2 + -9.10391092084235*H3 + -0.302616026345965*H4 + -15.3727344886124*H5 + 4.82126169507395));
        double HH3 = tanh(0.5*(0.11978500630417*H1 + -0.630313070798802*H2 + 3.04523622079341*H3 + -0.0346501123435036*H4 + -3.71624809057001*H5 + 4.96290712183394));
        double HH4 = tanh(0.5*(0.643769339176236*H1 + -2.72393596002784*H2 + 7.3832687916468*H3 + 0.468018762305709*H4 + -12.8416888275121*H5 + 10.1834098660592));
        double HH5 = tanh(0.5*(1.79982001561055*H1 + -7.23633588610783*H2 + 7.29310325354606*H3 + 6.4533593837626*H4 + -2.35326935669492*H5 + 6.06539935980869));

        er_x = 11.4061024513199*HH1 + 19.2147727088013*HH2 + 3.70257998226066*HH3 + -14.8483487246602*HH4 + -9.65440849672829*HH5 + -11.0588801321559;
        er_y = 21.6695925474398*HH1 + 6.02588727942142*HH2 + -32.5283685111979*HH3 + -0.395300778517675*HH4 + -26.486478311749*HH5 + 13.9134863248379;
        er_z = -7.68469774195107*HH1 + -3.98069894474979*HH2 + 19.8471143765476*HH3 + -10.9914721498282*HH4 + 7.38504693232617*HH5 + -13.5070517004174;
    } else if(level == 2){
        double H1 = tanh(0.5*(-0.00114510767661053*x + 0.0117822668843969*y + 0.0144277387222621*z + 0.0215530417760202*rx + 0.00728730669234349*ry + 0.00373155118968855*rz + -2.13702049545295));
        double H2 = tanh(0.5*(0.000581286248976155*x + -0.000558772432363652*y + -0.00415676559154727*z + -0.0033201014360921*rx + -0.0088831443758492*ry + 0.00291691324368946*rz + 1.08239152047584));
        double H3 = tanh(0.5*(0.010106934664143*x + -0.00439027363387265*y + 0.0109039140579742*z + -0.00650334933123071*rx + 0.030860064429931*ry + 0.019530101023422*rz + -5.72419735002604));
        double H4 = tanh(0.5*(0.00195926448829603*x + 0.0123707588922182*y + -0.00607901532078664*z + -0.0159396308529165*rx + -0.000969991852403281*ry + -0.0212134487422253*rz + 5.0958294420343));
        double H5 = tanh(0.5*(0.0145238533891103*x + -0.0112506434021015*y + -0.0391459305038239*z + 0.0277422901392734*rx + 0.0134017898700165*ry + -0.00399232159813302*rz + 8.99059430319495));
        double H6 = tanh(0.5*(-0.0000543461923699914*x + 0.00969126016431874*y + 0.00762188840795219*z + -0.0261627337885231*rx + -0.00825097276067432*ry + 0.00327445027625097*rz + 0.390880207828337));
        double H7 = tanh(0.5*(-0.000633288698669852*x + -0.00442480704001003*y + -0.00650207718481433*z + 0.000625053621880109*rx + -0.01145921535123*ry + 0.0130934234776862*rz + -0.42023847677034));
        double H8 = tanh(0.5*(0.0120392226655855*x + 0.000398087955603475*y + 0.0000372845707912987*z + -0.00313349515925354*rx + 0.0234744718292629*ry + 0.0166029684070375*rz + 0.790319552712486));
        double H9 = tanh(0.5*(0.00476147583539532*x + -0.00699601530377212*y + -0.0077218420313536*z + 0.00268562521718636*rx + -0.0108774727953066*ry + 0.00260883939407631*rz + 1.1224588437137));
        double H10 = tanh(0.5*(-0.012966822768366*x + 0.0113625714702898*y + 0.000424344483700849*z + -0.00239213097903585*rx + 0.0273433111045307*ry + -0.00028315270919857*rz + 3.38112873722561));
        double H11 = tanh(0.5*(0.00214464318285379*x + 0.0105594890513079*y + 0.0119596475531326*z + -0.00254807362165733*rx + 0.0124456584842098*ry + 0.00570482014910276*rz + -0.671124911774742));
        double H12 = tanh(0.5*(0.00513116581350028*x + -0.00366359278544192*y + -0.00359554145301033*z + 0.0231229063855603*rx + -0.00938692423235331*ry + -0.00131976064976467*rz + -1.082265053315));
        double H13 = tanh(0.5*(-0.000336544996852958*x + -0.0098282045382797*y + -0.00655107588487366*z + 0.0123728472808649*rx + -0.0138092595041651*ry + -0.00759781643860568*rz + -1.40122006680057));
        double H14 = tanh(0.5*(0.00780299486568545*x + -0.000680849999099256*y + -0.0048116832373602*z + 0.00369783187483452*rx + -0.00592283353912077*ry + -0.00621140281554267*rz + 0.860635752460044));
        double H15 = tanh(0.5*(0.000551240783962448*x + -0.00914313679778246*y + -0.014903508110302*z + -0.0106006802572929*rx + 0.00793371909112067*ry + -0.00208546815019195*rz + 1.14389939233627));
        double H16 = tanh(0.5*(-0.169263280508005*x + 0.0169537032622856*y + 0.0315363303439339*z + 0.00895801496769237*rx + -0.0639989934927833*ry + -0.0844062153619483*rz + -4.33512144989131));
        double H17 = tanh(0.5*(-0.00279301971647003*x + -0.0096986048281107*y + -0.00456902149123157*z + -0.00603873044005817*rx + 0.0110627157321059*ry + -0.0085184775038648*rz + 2.71330160327312));
        double H18 = tanh(0.5*(-0.00133033255761177*x + -0.00684236363728166*y + -0.00540919925138988*z + -0.0269238551833017*rx + -0.00121885585904388*ry + -0.028567936999486*rz + 3.75384081101105));
        double H19 = tanh(0.5*(0.001301366790788*x + 0.00821972480229439*y + -0.000638799341511904*z + -0.0169683750737261*rx + 0.00509425125028686*ry + -0.0229657978065649*rz + 0.633328931772903));
        double H20 = tanh(0.5*(0.00391643137204572*x + -0.016449562759698*y + -0.0168896946898151*z + 0.0111874129626447*rx + 0.0147107647030949*ry + -0.00367588337989643*rz + 4.71967801120612));
        double HH1 = tanh(0.5*(-2.73563472439227*H1 + 2.70739983550109*H2 + 1.41233403018602*H3 + -0.630114776932492*H4 + -0.502662557333296*H5 + 0.680109894611585*H6 + -3.69566345111166*H7 + -2.37894280713227*H8 + 6.74577462315302*H9 + -2.19973259310494*H10 + 1.08283923184788*H11 + 3.55096031623192*H12 + -1.75221678079324*H13 + -3.61131503022806*H14 + -1.99056516448699*H15 + -1.42375620757663*H16 + 0.808290019976802*H17 + -4.50533862369147*H18 + 6.71833305069631*H19 + 0.218573332851469*H20 + -3.40983728756441));
        double HH2 = tanh(0.5*(-1.50580356318209*H1 + -1.8342207976581*H2 + 1.96742643900207*H3 + 0.86153875779056*H4 + 2.81888012571503*H5 + 2.70374294116398*H6 + -2.71762373037711*H7 + 3.68613584192145*H8 + 0.301130827643004*H9 + -1.04038588205477*H10 + 0.206649482604714*H11 + -0.60160315463061*H12 + -3.59947305486527*H13 + 0.289759036241316*H14 + 1.818624599824*H15 + 0.550253178582231*H16 + 1.32920386991964*H17 + 2.15706583419586*H18 + -3.46385647729229*H19 + 3.10551778740297*H20 + -0.723710001253229));
        double HH3 = tanh(0.5*(-4.14519815377839*H1 + -1.24621710335217*H2 + 0.291315375270247*H3 + -0.684328143393392*H4 + 0.743063566632361*H5 + -3.75364290561902*H6 + -5.23848489222343*H7 + 1.93802306079292*H8 + 8.15953579002986*H9 + 1.02842572017377*H10 + 1.07636028977666*H11 + -3.30168634433522*H12 + 0.0957011211326552*H13 + -6.33734657222302*H14 + -5.63843092620895*H15 + 0.685190916944366*H16 + -2.29202175809303*H17 + -0.349409856129542*H18 + 3.6402890380905*H19 + 2.83788380517473*H20 + -1.44641049318805));
        double HH4 = tanh(0.5*(3.94025924429976*H1 + -5.89600913198446*H2 + -2.38495141928011*H3 + 0.676040219902815*H4 + -2.1763470186672*H5 + -0.237096045481325*H6 + 0.386407334102171*H7 + 2.38396788195052*H8 + -1.45719049249148*H9 + 2.36982620186713*H10 + -3.60085058180667*H11 + -4.89816506977924*H12 + 2.27596886550801*H13 + 4.80549083061197*H14 + 2.64084666212686*H15 + 0.0494098676261234*H16 + -4.53091867566397*H17 + 2.71419215120767*H18 + -1.00365312708074*H19 + -0.635426972463882*H20 + 0.664820529820418));
        double HH5 = tanh(0.5*(-2.45743786488514*H1 + -2.3695412432234*H2 + 0.153997573160648*H3 + -0.114480249728723*H4 + -0.460378331067114*H5 + 1.92403456530312*H6 + -1.6015420570657*H7 + 3.1956568348549*H8 + -1.76439825451214*H9 + 3.38722709423233*H10 + -0.625206336510219*H11 + 2.89633431233907*H12 + 4.17922753990874*H13 + 1.97178650923738*H14 + -0.841363420970602*H15 + -0.059339433113179*H16 + 1.50784611032982*H17 + 0.643984587172111*H18 + -0.15633485917557*H19 + 1.63651036889035*H20 + -1.87382880691345));
        double HH6 = tanh(0.5*(-6.67673410944742*H1 + -1.11002653415734*H2 + -0.20383529150231*H3 + -2.68491018819254*H4 + -0.427060685859882*H5 + -1.63055337870662*H6 + -3.86606040746981*H7 + -0.507614627464048*H8 + 3.86385432255737*H9 + -0.512906799073391*H10 + -0.2064256335795*H11 + -0.598085674505858*H12 + 1.264236044385*H13 + -1.33720182718764*H14 + -0.317893728470289*H15 + 0.0943535580263078*H16 + 3.78113707363699*H17 + 1.69572463460863*H18 + -5.78703144252114*H19 + -1.63589909222335*H20 + -0.612247138041566));
        double HH7 = tanh(0.5*(4.02973110778563*H1 + -0.456687621805205*H2 + -5.05716625759399*H3 + 7.38107558346094*H4 + 4.98505150768939*H5 + 1.12529117228616*H6 + 0.25056214543359*H7 + 0.439763044201281*H8 + -0.48729297035783*H9 + 2.07066144841802*H10 + -2.960274457178*H11 + -2.89146832647651*H12 + 3.11931400631064*H13 + 2.76674992642657*H14 + -1.98779007568792*H15 + -5.13927380288224*H16 + 0.782479721324609*H17 + 0.0272754538149728*H18 + -3.00866838326872*H19 + 1.36669610946298*H20 + 4.21802494335738));
        double HH8 = tanh(0.5*(-2.19164564447315*H1 + -1.54533566408714*H2 + 0.317937825982866*H3 + 0.238919373356383*H4 + 3.51207098713497*H5 + 6.5566203166517*H6 + 3.90769958895594*H7 + -1.92323613454684*H8 + -1.54712875894483*H9 + 1.73786170758732*H10 + -3.31489785391606*H11 + 3.16612629730878*H12 + -3.13134340630187*H13 + 3.99026544788127*H14 + -0.212156435949399*H15 + -0.381314525765091*H16 + -0.0405625949038653*H17 + -0.526931053139535*H18 + -1.1839987031073*H19 + -0.612665931466141*H20 + 2.48204887586029));
        double HH9 = tanh(0.5*(2.15421177179114*H1 + 1.37072849847948*H2 + -1.55397280760365*H3 + -0.382842975704775*H4 + 0.51411416036596*H5 + -0.343369449564386*H6 + 3.82358025919987*H7 + 2.78773824161345*H8 + 0.655472703314165*H9 + 1.4504297814505*H10 + 0.75432046700343*H11 + -2.31722296040578*H12 + -2.20606893148679*H13 + -1.378025796005*H14 + -0.615785677244351*H15 + -0.692427043658691*H16 + -2.24859428490235*H17 + -3.13492431526552*H18 + -1.96559003210528*H19 + -1.34986525749702*H20 + 1.87676206479333));
        double HH10 = tanh(0.5*(1.60530567210354*H1 + 2.54168327205286*H2 + -1.83967957199859*H3 + -2.29692636690218*H4 + 0.100751995006859*H5 + -1.98934986663592*H6 + -5.2308819085017*H7 + 1.44373435630947*H8 + -0.0702834303178971*H9 + -1.58722728469498*H10 + -0.411907948809472*H11 + -0.122037761091845*H12 + -1.25854765121026*H13 + -1.37036935037582*H14 + 1.4849931644768*H15 + -0.226499237680711*H16 + -2.3393753872905*H17 + 3.64356494735257*H18 + -3.77583250303404*H19 + -0.0962959405678167*H20 + 0.571509904012413));
        double HH11 = tanh(0.5*(-1.55489187440683*H1 + -8.65916441025094*H2 + -1.28674929316044*H3 + 2.11195969873974*H4 + 0.172752858292286*H5 + -4.12538310793676*H6 + 0.533833011057457*H7 + 1.98903328264764*H8 + 1.5410158341662*H9 + -1.1027613804926*H10 + 0.08541045818518*H11 + -3.57287880115541*H12 + -0.483027385990631*H13 + 2.04049818374106*H14 + -1.0462349862441*H15 + 0.0227391487340373*H16 + -4.77669283473667*H17 + 1.68642798819051*H18 + -3.2379919789671*H19 + 0.546482985450222*H20 + 0.959814025440627));
        double HH12 = tanh(0.5*(-2.49508245841191*H1 + -2.41879794843389*H2 + -1.48656209061767*H3 + 0.282639073056345*H4 + -0.787031366382975*H5 + 3.63813525418306*H6 + -1.9732452496014*H7 + -0.765586390350706*H8 + 3.08102035297593*H9 + 0.133655889688154*H10 + -0.334720513907497*H11 + -1.53164816798316*H12 + 1.58946284274789*H13 + -0.932281888699719*H14 + -2.54432696238933*H15 + 0.144543901228809*H16 + 0.0554908851470755*H17 + -1.84240907435971*H18 + -0.626776225643157*H19 + 1.92264910453704*H20 + -0.579329405898875));
        double HH13 = tanh(0.5*(-2.60583384828534*H1 + 5.40279692381403*H2 + 1.44893164353377*H3 + -6.2313531937501*H4 + 0.440662921912942*H5 + -4.47846020360023*H6 + 2.37054335544525*H7 + -0.421288105070172*H8 + -3.25544866180975*H9 + -1.28576509367311*H10 + 3.49641042014205*H11 + -3.4021864742625*H12 + 1.98489013019956*H13 + 1.92215013064796*H14 + 4.55838203768832*H15 + 0.0725448479961242*H16 + -0.226762741405215*H17 + -0.472712886148725*H18 + -1.52690229196812*H19 + -2.78971988867635*H20 + 1.05115988182177));
        double HH14 = tanh(0.5*(0.378377525947531*H1 + 4.07789151587099*H2 + 0.72735942179512*H3 + 1.07819650626941*H4 + -0.891016872309954*H5 + 0.5654384951544*H6 + -1.2254096751681*H7 + -0.155959230748444*H8 + -0.401572652907943*H9 + 1.98415249702249*H10 + 0.0348534701527601*H11 + 4.21061939495578*H12 + -2.29787077924007*H13 + 2.20335982769741*H14 + 0.785179043704471*H15 + -0.279943721204392*H16 + 0.846239396941029*H17 + 0.122810987176004*H18 + -0.966261970329228*H19 + 0.510103229199976*H20 + -2.40694245924394));
        double HH15 = tanh(0.5*(4.04980162788232*H1 + -0.666953443818408*H2 + -1.17334117243466*H3 + 1.01231627762505*H4 + 1.56768428858568*H5 + -1.73926741178858*H6 + 2.87644427501181*H7 + -0.0573794494019204*H8 + -4.06686716904248*H9 + -1.22473870373392*H10 + -0.387263349654693*H11 + 0.00331419188785022*H12 + -0.559237338005649*H13 + -3.68766365516384*H14 + 6.79807460427656*H15 + 3.59274584861479*H16 + 0.296380460373499*H17 + -4.13822781549731*H18 + -1.250516778482*H19 + -2.5631494459955*H20 + 2.78189327357203));
        double HH16 = tanh(0.5*(1.49911642159618*H1 + -0.0220514547974987*H2 + 0.311965943836023*H3 + -1.82474736437988*H4 + -4.24071490191106*H5 + 2.38116261461755*H6 + -1.21574339335625*H7 + -2.95001429285649*H8 + 0.789794265927534*H9 + -0.153077735744749*H10 + -1.98125887886793*H11 + -3.67691517611072*H12 + -3.72265698162923*H13 + 4.18325631806052*H14 + -0.664052362159553*H15 + -0.82195708256248*H16 + 0.0717361353925128*H17 + 1.64035396160293*H18 + -2.11141692619582*H19 + 3.97431009040139*H20 + 0.816601142236808));
        double HH17 = tanh(0.5*(-2.38098094902749*H1 + 1.05874817614809*H2 + -0.69928097633448*H3 + -0.431126657484886*H4 + 0.400344771898583*H5 + 1.43562817895631*H6 + -2.7542556332622*H7 + -2.27946956665217*H8 + 2.72041240787341*H9 + 4.6148143034209*H10 + 4.12824170928819*H11 + -1.26427053202327*H12 + 5.84319466395095*H13 + 2.0689765089413*H14 + 0.204138071293021*H15 + 0.217906650578831*H16 + -3.40031188686315*H17 + -1.95353475761071*H18 + -2.787171970169*H19 + -0.733734133331283*H20 + -1.88554736510998));
        double HH18 = tanh(0.5*(0.283353427152593*H1 + 2.75050165423872*H2 + -1.37031585621199*H3 + 2.93942062606411*H4 + -0.715474765049554*H5 + 2.29842164084993*H6 + -1.60814967591964*H7 + 1.77103221759004*H8 + 2.74161045305432*H9 + -2.79592996635739*H10 + -0.835459137606813*H11 + 0.317009430924298*H12 + 0.670929207465738*H13 + -0.701900575861237*H14 + 0.97008482066897*H15 + -3.7969121476132*H16 + 3.30036878815845*H17 + 2.27296474838685*H18 + -0.233000908908141*H19 + -3.07924624710898*H20 + 0.290229599335055));
        double HH19 = tanh(0.5*(-2.60322990363077*H1 + -3.84019496950987*H2 + 1.35781993004671*H3 + 0.193052907321593*H4 + 0.3748898413835*H5 + -3.28215953336473*H6 + 5.09569954013792*H7 + -1.6547696691479*H8 + -5.33457177261391*H9 + -0.636766731126*H10 + -2.4328448862808*H11 + 3.72252640215018*H12 + -3.6199724219157*H13 + 2.80947988975397*H14 + 5.17476789208389*H15 + -0.562215267910024*H16 + 3.19638657315534*H17 + -0.354037430121123*H18 + -1.79233358101613*H19 + -3.74246929645725*H20 + 3.06057604974716));
        double HH20 = tanh(0.5*(1.35215844519025*H1 + -0.756785749902546*H2 + -0.474475106481314*H3 + 1.97528943068117*H4 + -1.82659250373289*H5 + -0.516321606805706*H6 + -0.924492424457785*H7 + -1.69169775849969*H8 + 0.00620862758374483*H9 + -0.290896321423435*H10 + -0.616189221547346*H11 + 1.1226983081661*H12 + 1.38099558080456*H13 + -1.62938646788545*H14 + 1.15972810381411*H15 + 0.0125971538112028*H16 + -2.953462608663*H17 + -2.16621602052715*H18 + -1.46496696009016*H19 + 1.50511711546517*H20 + -0.697538900506692));

        er_x = -4.86978000799874*HH1 + -1.73346277957164*HH2 + 0.0136771956982392*HH3 + 3.38788165298171*HH4 + -3.40727900321013*HH5 + -0.078505705920468*HH6 + 0.27622156705399*HH7 + 0.622443260914342*HH8 + 0.307402052258977*HH9 + 2.44916173927236*HH10 + -5.73698182394488*HH11 + -3.73161657437372*HH12 + -2.65385043537094*HH13 + -4.25404260384327*HH14 + 0.866756537910729*HH15 + -1.88931262476588*HH16 + -1.09876600350101*HH17 + 0.212546391352056*HH18 + 3.75273482495468*HH19 + 0.402170870863844*HH20 + 4.39949771150814;
        er_y = -0.502875700955255*HH1 + -0.106363624332687*HH2 + -2.56975275992137*HH3 + -1.29221647162513*HH4 + 2.18495159246319*HH5 + -6.41586112567808*HH6 + 3.65806348690421*HH7 + 3.3650415979693*HH8 + 8.63502830083226*HH9 + -9.6318583480978*HH10 + -3.83683934502749*HH11 + 5.09210957311187*HH12 + -10.1330601213211*HH13 + -5.04159788207225*HH14 + -0.972004285262445*HH15 + -5.33273782103544*HH16 + -2.6027073256127*HH17 + -7.40215996418824*HH18 + 7.48250851545343*HH19 + 0.428634932887441*HH20 + -1.93785239416865;
        er_z = 0.73164322275622*HH1 + 1.16019919967769*HH2 + 1.7344586491294*HH3 + -3.91717812641938*HH4 + 2.54529883191864*HH5 + 4.76486864693318*HH6 + 9.19519676354998*HH7 + 2.05607689848524*HH8 + -2.84730791408353*HH9 + 1.43546646862347*HH10 + -0.496961800849633*HH11 + 3.26625283350033*HH12 + 0.253282276411252*HH13 + -7.45238236950034*HH14 + -5.57854913024241*HH15 + -15.7194565386007*HH16 + 0.986633058993773*HH17 + 4.5295757971407*HH18 + 2.1602660138216*HH19 + 1.80009077695722*HH20 + -1.36839034903014;
    } else if(level == 3){
//        double H1 = tanh(0.5*(-0.0154630079170133*x + -0.00194922353513925*y + 0.000398577100557439*z + -0.00552411264734068*rx + 0.0157121733660516*ry + 0.0256991909241731*rz + 3.70522657131942));
//        double H2 = tanh(0.5*(-0.00519927415976412*x + 0.00327876843461684*y + 0.018983569652465*z + 0.000361233122172403*rx + -0.0121995057209273*ry + -0.00996962589626214*rz + -2.42508422045419));
//        double H3 = tanh(0.5*(0.00385221645074541*x + -0.0173990267830926*y + 0.00108305225134089*z + 0.0241297405243453*rx + 0.0542645887269928*ry + -0.00313367305988857*rz + 1.95680159198101));
//        double H4 = tanh(0.5*(0.0137782653182884*x + -0.00119485071944449*y + -0.0339684638835099*z + 0.0180335954041644*rx + 0.0510670377568598*ry + 0.0291171362177985*rz + 6.18310699695691));
//        double H5 = tanh(0.5*(0.0319228703446149*x + 0.10022922025811*y + 0.0244304614657673*z + 0.0574499099826331*rx + -0.00400812794096472*ry + 0.0134250236348843*rz + -3.95012780460809));
//        double H6 = tanh(0.5*(0.0000320975926594365*x + 0.0030406052579962*y + -0.00235565208929737*z + -0.00155272839353417*rx + 0.0227562996561207*ry + -0.0367400274759405*rz + -3.29879635639299));
//        double H7 = tanh(0.5*(-0.00302209986799722*x + -0.00521751638271297*y + 0.00579589838526533*z + 0.0213016977633754*rx + -0.00100410817339552*ry + -0.00223043376629448*rz + 1.73298062945543));
//        double H8 = tanh(0.5*(-0.000971269610314309*x + -0.0246188021858367*y + 0.0178846457418323*z + -0.00350135326674766*rx + 0.00480300625924982*ry + 0.0216773625468291*rz + -4.3570840158565));
//        double H9 = tanh(0.5*(-0.0181632377229275*x + 0.0136265131607987*y + -0.00487586003583791*z + -0.000166023797592654*rx + 0.034868831734526*ry + -0.000836881934834481*rz + 1.49475517317955));
//        double H10 = tanh(0.5*(0.0219803389337579*x + 0.00550565179836521*y + 0.00482004889194874*z + -0.00078651267127205*rx + -0.0130158550311913*ry + 0.0120924424801979*rz + -2.72567911901081));
//        double H11 = tanh(0.5*(-0.00717154368083538*x + 0.000418158687891933*y + 0.00488663134922669*z + -0.0149512846494902*rx + 0.023604684991756*ry + -0.00351459788432513*rz + 3.30151357447136));
//        double H12 = tanh(0.5*(-0.00598910097807645*x + 0.00810313179934038*y + 0.0107798034492705*z + 0.0240470557703843*rx + 0.0382932320669332*ry + 0.00899698888511598*rz + -2.49325575941888));
//        double H13 = tanh(0.5*(0.0210320620801979*x + 0.00359778058996447*y + 0.00258867087779981*z + -0.00306403876211414*rx + 0.0290942739805201*ry + 0.0036347541449432*rz + -1.23225786168312));
//        double H14 = tanh(0.5*(0.00217805320066983*x + -0.00392865449923562*y + 0.0141512113763215*z + -0.00400115037386101*rx + 0.0224561039349488*ry + 0.00659436480378406*rz + -3.8398193485896));
//        double H15 = tanh(0.5*(0.0494905856434797*x + 0.00132630133891892*y + 0.0332288754995839*z + -0.0192935735940369*rx + 0.0335097097620436*ry + -0.0626941816226099*rz + -3.59250978505696));
//        double H16 = tanh(0.5*(-0.0288298908634365*x + -0.0126703499620061*y + -0.0140731669481187*z + 0.0184283796603001*rx + -0.0101334533335945*ry + -0.000535920432280869*rz + -0.645829270186642));
//        double H17 = tanh(0.5*(-0.00967458929062191*x + 0.0205004793986562*y + 0.0115616705423221*z + -0.00594061838507034*rx + -0.0592984120997479*ry + 0.0137217288340809*rz + -3.95190120708645));
//        double H18 = tanh(0.5*(0.000910762841374699*x + 0.0148691200158364*y + -0.0016639470392805*z + 0.00193860531811815*rx + 0.0214140976257072*ry + 0.0105752656078261*rz + 1.28074871939719));
//        double H19 = tanh(0.5*(0.00178165020694685*x + -0.010135499757308*y + -0.00420525330832721*z + 0.00590923155164264*rx + 0.019188048914066*ry + -0.0187293102483784*rz + 1.04709826717744));
//        double H20 = tanh(0.5*(-0.00372751889610972*x + -0.022069576310604*y + 0.0000297953197598571*z + -0.00477411128676909*rx + 0.00521504892767316*ry + -0.00492321527732978*rz + 1.1771264883592));
//        double H21 = tanh(0.5*(-0.0283305646802355*x + -0.0017447916097591*y + 0.00305870892015886*z + 0.00313645453892361*rx + 0.02139276713188*ry + -0.0250449314993888*rz + 1.39096401333182));
//        double H22 = tanh(0.5*(0.0051728658588909*x + -0.00850656879146293*y + 0.0143510063646451*z + 0.00253115142241424*rx + 0.00765138351289023*ry + 0.00354789063982941*rz + -4.44953901389125));
//        double H23 = tanh(0.5*(0.0124770493308015*x + -0.0291854898557806*y + -0.0258372071698842*z + -0.00637603213330805*rx + 0.0127821311409921*ry + -0.00643844855543444*rz + 9.27248186427067));
//        double H24 = tanh(0.5*(0.0158734004154458*x + 0.0012382387451689*y + -0.00325462731170586*z + 0.0174888983256741*rx + 0.0353164553516151*ry + 0.00364064610526223*rz + 2.2436776229462));
//        double H25 = tanh(0.5*(-0.0164025765736439*x + -0.00194570398561557*y + -0.00776681722380847*z + -0.0132953874640845*rx + -0.0214457235552204*ry + -0.00643045048841234*rz + 2.32394790592035));
//        double H26 = tanh(0.5*(0.00271995416517978*x + -0.00597127957684939*y + -0.000770389250413649*z + -0.00357679287924679*rx + -0.0121011884698494*ry + 0.0133275744162816*rz + 2.0164442424197));
//        double H27 = tanh(0.5*(0.000840582460312055*x + 0.00899590278454802*y + 0.0612849195000123*z + -0.0614328258742768*rx + 0.00705212982426615*ry + -0.00808604510150404*rz + -9.59684311521414));
//        double H28 = tanh(0.5*(0.0219979282264911*x + 0.000993458969631474*y + -0.00863057214694958*z + 0.000267505845010793*rx + -0.00132063769668988*ry + 0.00136252222247738*rz + 2.37215259078457));
//        double H29 = tanh(0.5*(0.00484680433389995*x + 0.00419328637570063*y + 0.00810190330471476*z + 0.00503043800227812*rx + -0.00892086026462836*ry + 0.0349830552072847*rz + -5.84300012303553));
//        double H30 = tanh(0.5*(0.00310910987220176*x + -0.00776510808294299*y + 0.00404786199240554*z + 0.0307687961996745*rx + -0.0235293490477861*ry + -0.00928125703628547*rz + -1.81617303553035));
//        double HH1 = tanh(0.5*(-0.565778406244882*H1 + 3.58667628496172*H2 + 3.68332083790688*H3 + 1.03682903422833*H4 + 3.40134269355596*H5 + 2.54166635507445*H6 + -6.04834230193842*H7 + -1.01840279783537*H8 + -2.51854370651801*H9 + 0.202340879746358*H10 + 1.89300233196754*H11 + -0.0110179740749153*H12 + -1.31221636711503*H13 + 2.19272975402211*H14 + 2.12498389501185*H15 + 0.377505794401675*H16 + -3.94545989087063*H17 + 4.15477128855201*H18 + 2.10258470844144*H19 + 0.656252113706282*H20 + -2.84601208388479*H21 + -3.0780693167375*H22 + 1.17559844270648*H23 + -1.66068813056423*H24 + 1.11605711753323*H25 + 2.24690520512543*H26 + -1.66996081842439*H27 + -0.0252560397686087*H28 + -3.17318441878868*H29 + 1.52415377417749*H30 + 3.08547099248974));
//        double HH2 = tanh(0.5*(-1.02075628448329*H1 + -1.23416338449377*H2 + -1.3729343990794*H3 + 0.12794550719897*H4 + 2.14698715281184*H5 + -0.0886073742898786*H6 + -3.07275722821776*H7 + -1.02390717923435*H8 + -1.94519308096716*H9 + -2.17243914642668*H10 + -3.6246869726313*H11 + 1.98869727885271*H12 + -1.41179069457053*H13 + 5.21168107279499*H14 + -0.479292138595567*H15 + -0.214060513171445*H16 + 0.318641652196358*H17 + 3.24235352946285*H18 + 1.38431033419259*H19 + 1.49967874897669*H20 + -0.214280387139073*H21 + 0.632418622393443*H22 + 0.804881364248931*H23 + 0.318589062506992*H24 + 0.16342081558089*H25 + 1.26906383220963*H26 + -0.479018154373554*H27 + 1.11886112048724*H28 + -1.39448686520487*H29 + 1.67746143449566*H30 + 2.42921589136442));
//        double HH3 = tanh(0.5*(1.64231453301819*H1 + -1.17212051779273*H2 + 0.789500029089452*H3 + -0.963979671742291*H4 + -1.72398465835811*H5 + -0.0231567331533785*H6 + -2.36800678169527*H7 + 0.425699956829041*H8 + 0.843531766001444*H9 + -1.51437247406375*H10 + 3.60726981272106*H11 + 1.01251397711486*H12 + 0.683964173426748*H13 + 1.73736368790477*H14 + 0.419195063375405*H15 + 1.04127452393412*H16 + 0.590962797112762*H17 + -2.85826800576302*H18 + 1.77860186889671*H19 + -2.14379528971373*H20 + -2.7442259939675*H21 + 2.92500423218449*H22 + -0.0992437379710173*H23 + -0.905774604308078*H24 + 0.826335950541319*H25 + 2.40585175591834*H26 + -1.72262062991909*H27 + -0.145063349871279*H28 + -2.51906170538194*H29 + -0.831200025645575*H30 + -1.81580238188851));
//        double HH4 = tanh(0.5*(0.31800241961927*H1 + 2.81761664128798*H2 + -0.200768899978702*H3 + -0.556178633595251*H4 + -1.98991704536576*H5 + -1.96394524669536*H6 + 4.57730321099741*H7 + 3.02686196333321*H8 + 2.1855699582698*H9 + 2.85298550522866*H10 + -3.99992842583516*H11 + 1.33534063055837*H12 + -2.69836364105231*H13 + 1.22916801205787*H14 + 4.01624808906884*H15 + -1.83233892896457*H16 + 0.511424700127999*H17 + 1.49628379145816*H18 + -0.442176814560615*H19 + 0.865279748436637*H20 + -0.128758855187963*H21 + 1.00025769213087*H22 + 1.30209473359854*H23 + 0.660738137700833*H24 + -0.46575872022809*H25 + 0.296620630569015*H26 + 1.44818471620275*H27 + 3.43566312462624*H28 + -1.40600193256052*H29 + 0.887899433446812*H30 + 0.65892370799687));
//        double HH5 = tanh(0.5*(3.93325648581966*H1 + 1.33858749185778*H2 + 0.266370940571723*H3 + 2.17570443421408*H4 + 0.285336275049446*H5 + -0.592189542302603*H6 + -0.653775177237442*H7 + 0.391835848623804*H8 + -3.51653138089046*H9 + 1.97080335131078*H10 + -4.2113187841612*H11 + 2.11933075728804*H12 + -0.25801183111946*H13 + 0.474577573576128*H14 + -1.91768321654168*H15 + 2.91583320952313*H16 + 0.266901562109384*H17 + -0.9318517895264*H18 + 0.10025763780512*H19 + 0.728482970354165*H20 + 2.57298835046893*H21 + -1.78053489831098*H22 + -2.2810000753251*H23 + 0.148861437586803*H24 + -1.03002641814249*H25 + -2.25005379226068*H26 + -2.22859681268848*H27 + 0.231464395507519*H28 + 0.100560052272323*H29 + -0.473843177637222*H30 + -3.27460300935564));
//        double HH6 = tanh(0.5*(-0.154003186647269*H1 + 2.931631411435*H2 + -1.15499524900443*H3 + 1.41894865907649*H4 + -2.25111192016715*H5 + 0.577741089545415*H6 + 1.5372821962786*H7 + 0.279787112523738*H8 + -0.535982827971327*H9 + -0.534540883453965*H10 + -6.0423117517297*H11 + 3.54007190410851*H12 + 0.332365744295362*H13 + -0.0310532493112248*H14 + -2.06106515210173*H15 + 0.3481056207772*H16 + 1.32080114177634*H17 + 1.95414639510877*H18 + 1.34547926685672*H19 + 1.54658145249744*H20 + 1.42252779800884*H21 + -2.91591468835822*H22 + -0.973450098656171*H23 + 0.84085536553063*H24 + 0.583884547237179*H25 + 3.0206379023147*H26 + -1.60128514474088*H27 + -3.6765670906534*H28 + -0.246836366626735*H29 + 0.59945114234914*H30 + 2.59227088094386));
//        double HH7 = tanh(0.5*(2.18359724506223*H1 + -0.684954629143018*H2 + -3.95983673812653*H3 + -1.04365130168697*H4 + 1.15744121297543*H5 + -1.27800277549111*H6 + 0.19996272799467*H7 + -1.94782830370974*H8 + -1.10498197771929*H9 + -0.193013632434305*H10 + -1.14749456671505*H11 + 0.0424324707123265*H12 + 1.55385143380854*H13 + -0.0699459550031606*H14 + -0.478465020876554*H15 + 1.62017365215974*H16 + -1.38464344160809*H17 + 1.09543898593965*H18 + 0.279267423503914*H19 + -4.85536036102611*H20 + 2.81299918713634*H21 + 1.22351235601664*H22 + 1.07548074070778*H23 + 3.45316869616827*H24 + -0.572431137214295*H25 + 1.58694098514494*H26 + 1.69931568501532*H27 + 0.348780601147017*H28 + -0.760757184776229*H29 + -0.932556452167447*H30 + 2.06361367185824));
//        double HH8 = tanh(0.5*(1.9316112822728*H1 + 0.952980156640763*H2 + 0.163835327423882*H3 + -2.3782922023638*H4 + 2.87385144060006*H5 + -0.990874900296882*H6 + 1.40376491074945*H7 + 4.70843269066321*H8 + -2.00969895130588*H9 + -3.72172834836479*H10 + 0.792029638536693*H11 + 0.93985879649499*H12 + 2.38207978675216*H13 + -2.92169058489688*H14 + -1.38899790977754*H15 + 2.35974079217502*H16 + -1.31160414465205*H17 + 1.51330730216583*H18 + -1.11516920001331*H19 + -2.43205044587584*H20 + 4.29716028969658*H21 + -0.687424632567247*H22 + -4.84641655831159*H23 + -0.440561105953478*H24 + 1.97741354572515*H25 + -3.03366741076612*H26 + 0.840150338847748*H27 + 2.19139278709927*H28 + 0.935899770177332*H29 + 0.52148684517258*H30 + 1.73485835594216));
//        double HH9 = tanh(0.5*(-2.09193363964326*H1 + 1.86740209881954*H2 + -0.673544827629389*H3 + -1.17445526508642*H4 + 1.96672280504357*H5 + 1.60635504390122*H6 + 1.00044401783675*H7 + 3.3642981982623*H8 + -1.42293194281093*H9 + -2.65767763714648*H10 + 1.01185079718371*H11 + -0.213199545167603*H12 + 1.90357699996508*H13 + -0.49133361812364*H14 + -0.135006782739612*H15 + 1.60362069045541*H16 + -0.644789549740877*H17 + -1.40995166723392*H18 + -1.92551205597784*H19 + -0.442501291625467*H20 + 0.289922039811432*H21 + -0.244305908903644*H22 + 0.476407466148733*H23 + -3.2132161979986*H24 + -0.565073005732006*H25 + -1.06602457890895*H26 + -1.55449545591765*H27 + -1.22155670521362*H28 + 1.87751942410007*H29 + 1.44937735222755*H30 + -2.23277455684126));
//        double HH10 = tanh(0.5*(-1.83010527162275*H1 + -1.30161617518279*H2 + 1.4849278362748*H3 + 1.41428965637909*H4 + 0.784697563604899*H5 + 0.19297131312464*H6 + 1.10337357894355*H7 + 0.647419045032637*H8 + -2.91068366553284*H9 + -0.280787114220753*H10 + -1.44502758148329*H11 + 0.478727522788896*H12 + 0.208262933643419*H13 + 0.84889427680982*H14 + 2.66754621021319*H15 + 2.94626892679847*H16 + -3.18376845851543*H17 + 0.0859253988423283*H18 + 2.09819717873758*H19 + -1.81494377589962*H20 + -0.287336595977313*H21 + 0.174726451462638*H22 + -1.78683250087694*H23 + 0.696246275692379*H24 + -2.7201757042369*H25 + 2.48894570638789*H26 + -2.12218616937891*H27 + 2.30361931249944*H28 + 0.318127064459312*H29 + -0.272883754102572*H30 + 0.0787757238745048));
//        double HH11 = tanh(0.5*(-2.25398569510715*H1 + -0.766827753266777*H2 + -1.4844922643139*H3 + -0.273677947809776*H4 + 5.03720578244579*H5 + 2.08544390266287*H6 + -3.53796215524919*H7 + 1.14852585867561*H8 + 0.481888996015116*H9 + 0.795929014920136*H10 + 0.486474761299329*H11 + 3.31815107952669*H12 + -1.18505787916332*H13 + -0.683663292324132*H14 + -0.30496797062684*H15 + -2.07280349023883*H16 + 0.0227805184696901*H17 + -1.26825936619209*H18 + -1.4292578077121*H19 + 0.452176503105899*H20 + -1.81761924753668*H21 + 1.28933896442919*H22 + -1.89013510536679*H23 + 1.12402961324213*H24 + -2.44264116625166*H25 + 1.4244901948336*H26 + 6.45836549720613*H27 + -1.45150256823568*H28 + -0.966966410601091*H29 + -3.22994093168364*H30 + -0.584586673132106));
//        double HH12 = tanh(0.5*(3.47496014957043*H1 + -2.2334918518427*H2 + -4.13212717141377*H3 + 0.971782540340685*H4 + 4.69080897110185*H5 + -1.3522656551244*H6 + -2.74219084340109*H7 + -0.488376756541234*H8 + -3.47308886831023*H9 + -4.4075887485942*H10 + 0.514916644179227*H11 + 0.924766378307691*H12 + 1.39566995932036*H13 + 2.92670246212258*H14 + -1.21881533138504*H15 + -1.19758139672865*H16 + -1.53256789831357*H17 + 4.94828816433216*H18 + 0.592953198329109*H19 + -2.28110526412044*H20 + 0.37490396912475*H21 + 1.33059074265392*H22 + -3.02446451376379*H23 + 1.68071917057778*H24 + -0.272668969414928*H25 + 0.403282493557077*H26 + 1.76539215146273*H27 + -6.74932047368796*H28 + -0.0601688737842661*H29 + 4.19684179186287*H30 + 0.163922698822177));
//        double HH13 = tanh(0.5*(2.35818786271782*H1 + -1.29624744060019*H2 + -1.45370712145699*H3 + -1.84723331496182*H4 + -1.49556930732762*H5 + -0.919243126791962*H6 + 2.82373277505557*H7 + 5.95550308248243*H8 + -1.06670078901109*H9 + -1.65344954710574*H10 + -1.32080893100757*H11 + 1.23414974135686*H12 + -0.931199136174435*H13 + -1.27751266413691*H14 + 0.246065135437384*H15 + 1.87893824794501*H16 + 2.59383641117643*H17 + -2.09699233055682*H18 + 7.52348202690257*H19 + 1.1435507300749*H20 + 2.25802634135077*H21 + 3.31546527295473*H22 + -0.896682244844953*H23 + 0.362775368510345*H24 + -1.19387202492559*H25 + -1.83548010646975*H26 + -0.0806855468297653*H27 + 2.68486102666202*H28 + 2.34671389310113*H29 + -2.65975823311757*H30 + -0.616500109707258));
//        double HH14 = tanh(0.5*(-1.1598479213717*H1 + 0.826036702835945*H2 + -1.84115783659285*H3 + 2.50748898517026*H4 + 0.186296842063633*H5 + 0.0717889980901522*H6 + 0.674418281053657*H7 + 1.07762070830088*H8 + 0.350133685193432*H9 + -0.532210415604917*H10 + 0.191498037054534*H11 + 2.53937479843806*H12 + 1.52453554421696*H13 + 3.20686280587727*H14 + 2.98068288064901*H15 + -0.131134684540685*H16 + -3.02774655495752*H17 + -1.25220168269663*H18 + -1.66120275074192*H19 + -2.39135144657717*H20 + -2.7855859072392*H21 + 0.780917729040813*H22 + -2.74840196314894*H23 + 1.94581093258028*H24 + -2.8767901758285*H25 + -0.496328504767736*H26 + -1.18839559069189*H27 + -1.58785249002897*H28 + -0.970758887021856*H29 + 0.497430240239173*H30 + 1.13535238283025));
//        double HH15 = tanh(0.5*(-0.510399733932713*H1 + 3.49008137529978*H2 + 3.48987592894999*H3 + 0.671321441197536*H4 + 1.34322171420778*H5 + -0.71906380475805*H6 + -1.91159733307444*H7 + -1.28181959499853*H8 + 3.22992035095939*H9 + 1.34573163050783*H10 + -0.153601033113291*H11 + 0.538217761842972*H12 + 2.09845553686111*H13 + -1.17633903088921*H14 + -0.77695245598587*H15 + 0.0337892043707246*H16 + 0.281276165837766*H17 + -0.863052593316723*H18 + -1.30590513951502*H19 + -2.74605304159871*H20 + -0.717254470415235*H21 + -1.81151233789697*H22 + 4.31562834789893*H23 + -0.405010819370505*H24 + 0.474530584414699*H25 + 0.656143178952498*H26 + 2.17954611758013*H27 + -1.3580112546824*H28 + -0.547612716405206*H29 + -0.336338253121726*H30 + -1.8541777349264));
//        double HH16 = tanh(0.5*(-2.71160863325005*H1 + -2.95080301768415*H2 + 2.29260636455068*H3 + 3.63289056608992*H4 + 5.34040055012684*H5 + -1.22024491017096*H6 + 0.429179283137063*H7 + 2.00496159433458*H8 + -1.80364961044278*H9 + 5.0585766779052*H10 + -0.835409953688308*H11 + 0.2182401964203*H12 + -0.114878382370249*H13 + 1.94690910196356*H14 + -4.05336444978956*H15 + -0.808640150526301*H16 + 4.35571517143277*H17 + 2.20805714248022*H18 + 0.302335197905582*H19 + -2.32621943389117*H20 + 1.81090126788374*H21 + -1.00715351076148*H22 + 3.45982575260342*H23 + 2.91458247138991*H24 + 1.9284532445001*H25 + -0.573206784024838*H26 + -2.03140586782187*H27 + -4.7587665286667*H28 + 4.04857556889224*H29 + 1.60312198218426*H30 + 0.418340349394081));
//        double HH17 = tanh(0.5*(-6.224412841175*H1 + 1.8642182449812*H2 + -1.14651068164991*H3 + -10.6434791606077*H4 + 0.696097562668869*H5 + 2.05588332199043*H6 + 1.27974342102162*H7 + -3.16256920363808*H8 + 4.36008707956479*H9 + -5.80979845808068*H10 + -2.40440345185048*H11 + 2.46368027039176*H12 + -0.851736457694996*H13 + 3.05342498174362*H14 + 0.403989618167331*H15 + -0.177244621251764*H16 + 1.82481435913681*H17 + -0.61290774204688*H18 + 0.163562439947875*H19 + 0.570497482851585*H20 + 6.95590122561607*H21 + 1.57542549256215*H22 + -3.19876351070358*H23 + 0.84843122771493*H24 + 1.19563936045112*H25 + -1.62728858859162*H26 + 5.68752607332645*H27 + -1.98386959991097*H28 + -0.765504086672296*H29 + 2.01287755114756*H30 + 2.80629842366573));
//        double HH18 = tanh(0.5*(-0.228075467577129*H1 + -0.623641307721685*H2 + 0.295981510161971*H3 + 0.165029298624179*H4 + -1.96040128214461*H5 + 0.267896312529329*H6 + -1.18320765138105*H7 + -0.753219840957475*H8 + -2.56662695954564*H9 + -1.94982418135681*H10 + 3.32918839209729*H11 + 0.565485054743713*H12 + 2.20636159883917*H13 + -2.75781834782851*H14 + 0.835357978803302*H15 + 0.763388370657431*H16 + -0.197007924656229*H17 + -0.583625938092902*H18 + -0.428348557890725*H19 + -0.0663300205850056*H20 + -3.36661727858056*H21 + 1.40254583361531*H22 + -0.532169413053537*H23 + -1.77141718416344*H24 + -4.54829715917735*H25 + -0.873107726012333*H26 + -1.00106053145347*H27 + -1.93837770999554*H28 + 0.56099202340479*H29 + -5.68456417949046*H30 + 0.459952362128885));
//        double HH19 = tanh(0.5*(2.30781145204572*H1 + -1.03509371739495*H2 + -0.742484075417079*H3 + 1.20417376358262*H4 + 0.852411506528941*H5 + 1.10529452162446*H6 + -1.292930386992*H7 + 0.136392758114728*H8 + -0.510541606173096*H9 + 0.0330959161941402*H10 + -1.0937360950712*H11 + -1.12271143506226*H12 + 1.46614112129022*H13 + -1.78401348283867*H14 + -0.966989247399844*H15 + 0.125040497534448*H16 + -0.735618624925804*H17 + -3.14935830064408*H18 + -0.937024566236723*H19 + -2.26165855478662*H20 + -1.01998235763733*H21 + 3.86478334722937*H22 + 1.19135117226875*H23 + 1.21031451355518*H24 + -0.598380244437245*H25 + 0.418537261309347*H26 + -2.54259726980084*H27 + -5.23156499289222*H28 + -1.24164814489799*H29 + -1.47955523804166*H30 + 1.11439908911172));
//        double HH20 = tanh(0.5*(-0.534233118476085*H1 + -0.334833900304499*H2 + 0.563161180185897*H3 + -0.191417725245623*H4 + -1.2538391956052*H5 + 3.41252867747066*H6 + 1.42717869953566*H7 + -0.288277426780655*H8 + 0.48757021456965*H9 + 3.24728792370272*H10 + -1.49446068982117*H11 + 3.00617030755999*H12 + -1.11675713574107*H13 + 0.514172009725025*H14 + -1.85173951507685*H15 + 1.66737245345738*H16 + 1.049017231366*H17 + 4.55891961007993*H18 + 0.371384782570393*H19 + 2.548484014708*H20 + 2.1157304898254*H21 + 0.0600936048138524*H22 + -0.807370666810467*H23 + -3.13186983872953*H24 + -1.98919820917909*H25 + 2.99947438230462*H26 + 2.50158627267587*H27 + 0.632408013973459*H28 + 1.85019747496559*H29 + -3.09477319589694*H30 + 1.58908065384422));
//        double HH21 = tanh(0.5*(-3.90758263521855*H1 + 3.36675667884744*H2 + 0.00777911080641595*H3 + 0.639329542653871*H4 + 3.58311365379371*H5 + -1.96681620019234*H6 + -3.12813221003715*H7 + 0.388055422391138*H8 + 2.96123144740534*H9 + -3.54789177802609*H10 + -1.67848542006098*H11 + -1.88891331680369*H12 + -0.904281187834055*H13 + 3.16950414468728*H14 + -0.836277974814318*H15 + 1.24831443014736*H16 + -1.37081695244374*H17 + 3.22895491245286*H18 + 2.01757901537947*H19 + 0.0267291731037359*H20 + -3.74156541572664*H21 + -1.06863697679513*H22 + -0.401259038003314*H23 + 0.575233853327938*H24 + 0.264262587301981*H25 + -6.49404917365641*H26 + -2.47873676433848*H27 + -0.38555857545156*H28 + 0.138166539568203*H29 + 5.09854800154122*H30 + -3.46509283071364));
//        double HH22 = tanh(0.5*(2.75654925584605*H1 + -0.351162945516232*H2 + 0.850804679063637*H3 + -3.06849089919367*H4 + -0.884242210868978*H5 + 0.0791114475879817*H6 + 2.08190368778259*H7 + -0.565759700060772*H8 + -4.68859713313218*H9 + -4.30710365152495*H10 + 0.199618279943524*H11 + -1.98025623879019*H12 + 0.0584302811691711*H13 + 0.224801654015341*H14 + -0.297488446225025*H15 + 2.31604079069987*H16 + -1.06569661954589*H17 + 2.01533986946721*H18 + 2.37918119892673*H19 + -2.46238108228845*H20 + -0.446459451630228*H21 + 2.1506993703417*H22 + -1.74234224712885*H23 + -2.59086349821961*H24 + -4.02191082481423*H25 + 0.43770991988823*H26 + 1.72553415174384*H27 + -1.17538543097025*H28 + 1.06706403708019*H29 + 1.19548915291435*H30 + -2.73783994820685));
//        double HH23 = tanh(0.5*(0.266635008102802*H1 + -0.759494606085373*H2 + 0.99299352879201*H3 + -0.643606261285479*H4 + 0.575140348552068*H5 + 0.995026863657053*H6 + -1.27362964367419*H7 + -1.35031329457615*H8 + 1.01753737393846*H9 + -2.16452898614305*H10 + -2.17792657575929*H11 + 2.35714114174117*H12 + 1.63089092373691*H13 + 2.04189200525653*H14 + -0.792604361132364*H15 + -0.895965577943577*H16 + 0.0156216816796751*H17 + -2.16724218166438*H18 + -1.64357561445064*H19 + 1.08319040665024*H20 + -5.32258759670834*H21 + -3.33337254488794*H22 + -0.224546817837534*H23 + -1.5590845157448*H24 + 0.818445768064409*H25 + 4.91307498703283*H26 + 0.240835272186832*H27 + -0.191978756701614*H28 + -0.891210987314241*H29 + 3.05879919108919*H30 + 3.29923784462477));
//        double HH24 = tanh(0.5*(1.4363085036511*H1 + 1.59402915903951*H2 + -0.0129665459554179*H3 + -3.94266997653405*H4 + 3.15764344857922*H5 + -2.92647259547392*H6 + 0.435374839030034*H7 + -0.109711412613804*H8 + -0.882232980290487*H9 + -4.39890499440633*H10 + 1.85240450421401*H11 + -1.43006554681259*H12 + 0.594290697724417*H13 + -1.5724186313964*H14 + 6.67869137420593*H15 + -2.09945122969995*H16 + -1.20952076599214*H17 + 0.574349958915458*H18 + -4.53346084717137*H19 + -0.641230541165556*H20 + 0.505273092255901*H21 + 0.33276337445546*H22 + -0.388252173165578*H23 + 1.27079286842735*H24 + 3.03827953112704*H25 + 2.3842892650391*H26 + -1.98554116036392*H27 + 2.05874738606208*H28 + -6.82996030920492*H29 + 2.64969238428165*H30 + 1.26378511006187));
//        double HH25 = tanh(0.5*(-0.911750376921832*H1 + 2.30883754616129*H2 + 0.781156053004759*H3 + -0.510461596028055*H4 + 3.34543777349066*H5 + 1.02696837150065*H6 + -0.916536043685607*H7 + 2.80299271379723*H8 + -3.91888675465523*H9 + -1.16699323561803*H10 + -2.58324731558485*H11 + 1.9647347901871*H12 + -0.119025547046264*H13 + 1.05536797344539*H14 + -0.196197950665744*H15 + 3.62136888233175*H16 + 1.39611436746774*H17 + 0.512694835006183*H18 + 0.275798695951378*H19 + -1.66862108133459*H20 + -0.379925104376707*H21 + -0.108472394319646*H22 + -1.37030150062286*H23 + 0.843949571690872*H24 + -3.88460698532202*H25 + -1.02332694221032*H26 + -2.02632817617146*H27 + 0.371481884867031*H28 + -2.48209052091442*H29 + -0.925730237778329*H30 + -3.6057950414503));
//        double HH26 = tanh(0.5*(2.24558245742273*H1 + 0.165247307152775*H2 + 1.58638203811021*H3 + 1.98108524228898*H4 + 1.43239032914555*H5 + 4.1367344341481*H6 + -1.79617246731508*H7 + -0.500039744305434*H8 + -2.93310366042243*H9 + -0.623355521919981*H10 + -1.61157396308896*H11 + 2.89894563126588*H12 + 2.12067461497658*H13 + 0.539654938138779*H14 + 0.572508634973854*H15 + -2.58317584916929*H16 + -1.08110679711528*H17 + 1.42994992501837*H18 + -0.396772060573548*H19 + 2.52639110312557*H20 + -0.133062308795615*H21 + -2.44024132101516*H22 + -0.260521283605729*H23 + -0.825394374303599*H24 + 3.57224500438743*H25 + -1.17750777637013*H26 + -2.88202793759067*H27 + -3.72690489593221*H28 + 3.11230829942319*H29 + -1.41997458399315*H30 + -3.44771791609827));
//        double HH27 = tanh(0.5*(1.21370863594216*H1 + 2.01324492928172*H2 + 0.760443263749246*H3 + 0.292506954409524*H4 + -4.38172692475207*H5 + -1.96086810794887*H6 + -1.13091814536192*H7 + -0.941199054392448*H8 + 0.558303777322456*H9 + -0.358175479256037*H10 + -1.96208434002027*H11 + 1.33064037669779*H12 + 0.773508171567905*H13 + 0.598736758072917*H14 + -1.23214884938775*H15 + -0.565683504684923*H16 + -0.464872799828423*H17 + 0.032716509866506*H18 + 3.59146280925266*H19 + -0.128538469634044*H20 + 0.428532666405737*H21 + -0.532937840326524*H22 + 0.823103814932841*H23 + 2.32355900915442*H24 + 0.183975296427374*H25 + 5.44655017582433*H26 + -0.0310413910516465*H27 + 0.126477084614533*H28 + -1.29105817252348*H29 + 0.362981084413367*H30 + -3.92784968604476));
//        double HH28 = tanh(0.5*(4.76935673043278*H1 + -1.51999580019417*H2 + -0.584240074012742*H3 + -1.08894457237416*H4 + 0.331304170646671*H5 + -1.12017632301548*H6 + -2.44695892467511*H7 + 1.53661298312805*H8 + 2.57454084081863*H9 + 3.05136858047877*H10 + 2.6393459217051*H11 + 2.73150003875584*H12 + -1.57584941531702*H13 + -1.49969444698672*H14 + 2.47565500983985*H15 + -2.7684601413688*H16 + 0.226213820119614*H17 + -0.942170685794487*H18 + 0.602098954362054*H19 + 2.2528261833999*H20 + -1.50332551737859*H21 + 0.839484819136122*H22 + 0.0853521578194243*H23 + -2.0854657763907*H24 + 0.384873976619343*H25 + 1.93301194713786*H26 + 4.92335232232282*H27 + -2.32357803297946*H28 + -1.74570550682272*H29 + -1.51277753041271*H30 + -0.391105530547932));
//        double HH29 = tanh(0.5*(-0.296845898945655*H1 + -2.90755024305176*H2 + -0.11700656562026*H3 + -0.185760993851272*H4 + -3.59173153348607*H5 + -0.720892987398547*H6 + -1.00395329185746*H7 + -3.68140385164178*H8 + 1.40659526378857*H9 + 3.34532503119433*H10 + 6.38449795948987*H11 + 3.32048683145214*H12 + -0.381747465608834*H13 + 0.692603096033482*H14 + 0.0714766517898597*H15 + 2.32479570592244*H16 + -1.04718962848886*H17 + 3.12091985191111*H18 + 1.67765945885508*H19 + 1.40269594324615*H20 + -2.03190958316201*H21 + 2.50963420174634*H22 + 1.11509419684772*H23 + -0.76899943637673*H24 + -5.07314234777732*H25 + -1.92280232032946*H26 + 1.87890537758021*H27 + -2.52662393877556*H28 + -0.368153459370908*H29 + -0.402405461296748*H30 + -0.35386502490276));
//        double HH30 = tanh(0.5*(-1.34141155620375*H1 + 2.60584226107246*H2 + 1.26696136748602*H3 + 2.44431256112531*H4 + 0.771833618607103*H5 + 6.57938760314521*H6 + -1.07356999954613*H7 + -3.09768583029298*H8 + 3.12072776944512*H9 + -0.452926505684065*H10 + -2.3766154191486*H11 + -3.43415061097533*H12 + 0.942005825814031*H13 + -2.43679037269422*H14 + -0.931238152481674*H15 + 0.222767272563863*H16 + -0.211652729964535*H17 + -1.49239985462048*H18 + 1.65518686235772*H19 + 3.28507361922456*H20 + -2.11772133744283*H21 + 1.1660455343589*H22 + -1.11626383535224*H23 + -2.15019661333213*H24 + -0.348768426716544*H25 + 3.75704014383198*H26 + -3.90327321534879*H27 + -1.06978824531506*H28 + 0.826712915782189*H29 + 0.156218234765477*H30 + 5.15951436141206));

        double H2_1 = tanh((-0.796968711208052 + 0.00634746682999604 * rx + -0.0185328905986428 * ry + 0.00709972987777119 * rz + -0.00244568075045788 * x + 0.00351441340642931 * y + -0.00140257842478406 * z));
        double H2_2 = tanh((0.1978526021737 + -0.00134370363696292 * rx + 0.0169471157500223 * ry + 0.00356332607460972 * rz + -0.00219772202289651 * x + 0.00091826514481485 * y + 0.00247053039307577 * z));
        double H2_3 = tanh((3.83814393675944 + -0.00855717142518209 * rx + -0.0194628206500235 * ry + -0.00117614358772607 * rz + -0.00406063116991556 * x + 0.00205516203809624 * y + -0.0149336251435844 * z));
        double H2_4 = tanh((-0.623286090999988 + -0.000347470672350502 * rx + -0.0139390458710781 * ry + 0.00867904279389136 * rz + 0.00651247365022032 * x + -0.000683945673082936 * y + 0.000984912453944134 * z));
        double H2_5 = tanh((-1.72247913431656 + 0.00285378551118323 * rx + 0.00147328179061292 * ry + 0.0074992175071894 * rz + -0.00147361803603931 * x + -0.00268582457683175 * y + 0.00107296136036309 * z));
        double H2_6 = tanh((0.389153154350071 + -0.00135781558774036 * rx + 0.011457345733303 * ry + -0.0139117047905679 * rz + -0.00427719618542274 * x + 0.00343479228890564 * y + 0.00612376426624949 * z));
        double H2_7 = tanh((-0.0908229258502811 + 0.00318534116412667 * rx + -0.0128985821409542 * ry + -0.00137749875620469 * rz + -0.000619152731448763 * x + -0.00321736810725937 * y + 0.000957483701099124 * z));
        double H2_8 = tanh((1.02232093166385 + -0.00841987730380725 * rx + 0.00601469938749411 * ry + -0.00914800010897944 * rz + -0.00317906086461227 * x + -0.00117813379466398 * y + -0.00270529921108168 * z));
        double H2_9 = tanh((-0.261059869993653 + -0.000767974727136047 * rx + -0.0236422116990733 * ry + 0.00489716370793804 * rz + 0.00143277925297781 * x + -0.000355576045561782 * y + -0.00618399429448364 * z));
        double H2_10 = tanh((0.512759866956141 + -0.00560868366463886 * rx + 0.017149649242415 * ry + -0.00503267758846656 * rz + -0.00331806293532207 * x + 0.00428529599704926 * y + 0.000283989353739066 * z));
        double H2_11 = tanh((2.61014304434609 + 0.00691865651457507 * rx + -0.0144507949163785 * ry + 0.00271171866670969 * rz + 0.00536352424909222 * x + -0.00457957312119383 * y + -0.00861200352670202 * z));
        double H2_12 = tanh((0.923324611372216 + 0.00103934145972411 * rx + -0.017213131402632 * ry + 0.00389096296650688 * rz + 0.000600363852055324 * x + -0.00647454824858198 * y + 0.00031768695568708 * z));
        double H2_13 = tanh((0.328748706582942 + 0.00455673964876544 * rx + 0.00413011917887735 * ry + -0.00920967511286782 * rz + 0.00943657682504609 * x + 0.00442478302084881 * y + 0.00980073427867891 * z));
        double H2_14 = tanh((-0.208798867129073 + 0.00506355704338168 * rx + 0.000224074820807697 * ry + 0.000171772319740606 * rz + 0.00323194390731373 * x + 0.00507197608428729 * y + 0.000920493744730189 * z));
        double H2_15 = tanh((3.87031790208904 + -0.0000276959474382016 * rx + 0.00740125431371223 * ry + 0.0129221968114897 * rz + -0.000436178239295663 * x + 0.0101279346698536 * y + -0.00649673101725804 * z));
        double H2_16 = tanh((-0.853839968690313 + 0.0019293175475078 * rx + 0.0122683311012529 * ry + -0.0110341385332048 * rz + 0.0142803190102279 * x + -0.00434496278713742 * y + 0.0117725637705243 * z));
        double H2_17 = tanh((-2.53220998105627 + 0.0210425648251082 * rx + -0.0236496591979408 * ry + 0.00154879123609469 * rz + -0.000172406305511479 * x + -0.00645061066452184 * y + 0.00110925194309362 * z));
        double H2_18 = tanh((-0.279768784899084 + -0.00979084359715265 * rx + -0.0114467453619233 * ry + -0.0103209792543018 * rz + -0.00277944608372388 * x + 0.00478263938366477 * y + -0.00338841750613578 * z));
        double H2_19 = tanh((-6.21231406814533 + -0.00510000857014314 * rx + 0.00884501372056802 * ry + 0.0311450605407834 * rz + -0.00939311036975762 * x + 0.0139967117416945 * y + 0.0395568486843194 * z));
        double H2_20 = tanh((0.237768977857472 + 0.00475564366624536 * rx + -0.00134742142914541 * ry + -0.00831670001690499 * rz + 0.000820587816068236 * x + -0.00209790036741983 * y + -0.000682556626346247 * z));
        double H2_21 = tanh((10.4068265172509 + 0.047565732646701 * rx + 0.000871014146979697 * ry + -0.00227066543471247 * rz + 0.00306595904226252 * x + -0.00712313918206084 * y + -0.0563350816467787 * z));
        double H2_22 = tanh((2.6992398504617 + 0.00369050331703649 * rx + 0.015332722699032 * ry + 0.00119177904193692 * rz + -0.0109710416801022 * x + 0.00446751703295396 * y + -0.00603816084761916 * z));
        double H2_23 = tanh((-2.14497795302441 + 0.00136130635571056 * rx + 0.00569964895964522 * ry + 0.00533657765128183 * rz + 0.000882335714191995 * x + 0.000878769776282615 * y + 0.00451382290755687 * z));
        double H2_24 = tanh((0.341019582819367 + 0.0019187171026282 * rx + 0.00295725648815742 * ry + -0.00471651612924926 * rz + -0.00365489727942392 * x + 0.00432946387877404 * y + -0.00154166284395069 * z));
        double H2_25 = tanh((-0.790533926870583 + -0.00116409766129947 * rx + -0.0104865620357079 * ry + -0.00146049691737799 * rz + 0.00838826274129751 * x + -0.00102899773295009 * y + -0.0044833614597612 * z));
        double H2_26 = tanh((-1.78351626981463 + -0.00148249820809683 * rx + 0.00883846191030414 * ry + 0.0231261357617223 * rz + -0.00607739491599318 * x + 0.00446022238497514 * y + 0.000636700334303406 * z));
        double H2_27 = tanh((-0.327852858484396 + 0.00694316859612126 * rx + -0.0125072278670967 * ry + -0.00218698177659214 * rz + 0.0131944261907389 * x + 0.000945792347779024 * y + 0.000278486658371088 * z));
        double H2_28 = tanh((-1.59575821623198 + -0.00395678514561626 * rx + -0.00683473908445585 * ry + -0.00537081127698046 * rz + -0.000393992881514601 * x + -0.00730905036171795 * y + 0.0047611650635749 * z));
        double H2_29 = tanh((1.6277943844517 + -0.00399467885253067 * rx + 0.00275698743833291 * ry + 0.00227418300605482 * rz + -0.000550199644637179 * x + 0.00559131792380614 * y + -0.0100082401410821 * z));
        double H2_30 = tanh((0.551524143637035 + 0.00102004379702839 * rx + -0.0182182562559054 * ry + 0.00835013597799908 * rz + -0.00738980924207182 * x + 0.0113543622972956 * y + -0.00111765800559963 * z));
        double H1_1 = tanh((0.719808247437654 + -2.52591036616576 * H2_1 + -0.649364046571201 * H2_10 + 0.564659740385712 * H2_11 + -3.76258746317107 * H2_12 + 1.42775848217705 * H2_13 + 0.0722946409067342 * H2_14 + -2.18710663620213 * H2_15 + -1.01717450725455 * H2_16 + 1.32349911471224 * H2_17 + 1.66923366407333 * H2_18 + -0.17416149459185 * H2_19 + -0.688549996304804 * H2_2 + 2.41548217350217 * H2_20 + 0.0943773226159391 * H2_21 + 0.664932588238967 * H2_22 + 1.36829721942597 * H2_23 + -1.54138190882835 * H2_24 + -2.49143395541494 * H2_25 + 1.67847392514308 * H2_26 + -0.199005778292946 * H2_27 + -1.11147861466966 * H2_28 + 0.230762285726421 * H2_29 + 0.225592482007244 * H2_3 + 0.795444634044131 * H2_30 + 4.27291153572037 * H2_4 + -0.177684303063986 * H2_5 + 2.40625121759547 * H2_6 + 0.427827867500579 * H2_7 + 2.9414481703535 * H2_8 + 1.50957025455539 * H2_9));
        double H1_2 = tanh((-0.318381502129093 + -0.26682937716001 * H2_1 + -0.690367297771259 * H2_10 + -0.474925156467654 * H2_11 + -0.481650583412658 * H2_12 + -1.17087104726589 * H2_13 + -0.956645451516321 * H2_14 + -0.244754044858257 * H2_15 + 0.782220227737187 * H2_16 + -0.533016034235159 * H2_17 + -0.757701679492837 * H2_18 + 0.655393438392003 * H2_19 + -0.467205272117418 * H2_2 + -0.42209443176429 * H2_20 + -1.11199358743369 * H2_21 + -0.282585467589255 * H2_22 + -0.729787945027559 * H2_23 + 3.57533790992103 * H2_24 + -1.79825120668065 * H2_25 + -0.0141954040453252 * H2_26 + 0.0359627786363131 * H2_27 + -0.897535782218254 * H2_28 + 0.118381559373067 * H2_29 + 0.745247741670953 * H2_3 + -0.641761927747983 * H2_30 + 0.849204327550893 * H2_4 + 2.51504028583546 * H2_5 + 1.34241924649073 * H2_6 + 1.24802527675449 * H2_7 + -0.290817563887146 * H2_8 + -1.10911303247846 * H2_9));
        double H1_3 = tanh((-1.31988133173209 + -0.852486956090828 * H2_1 + 1.69716828308437 * H2_10 + 0.163937540844811 * H2_11 + -0.0250513024330722 * H2_12 + -0.377830781702748 * H2_13 + 0.403675873448881 * H2_14 + -0.172594928859764 * H2_15 + 0.831602698008274 * H2_16 + -0.671477012922947 * H2_17 + 0.617359276600393 * H2_18 + -0.993549202659112 * H2_19 + -1.61489177715714 * H2_2 + -0.372229680289954 * H2_20 + 1.26020232660105 * H2_21 + 1.01011585646154 * H2_22 + 0.856931135400525 * H2_23 + 1.14570362132983 * H2_24 + 0.727518950727521 * H2_25 + 1.34205169964507 * H2_26 + 0.895997530797194 * H2_27 + -0.696718238090618 * H2_28 + -0.937302531876721 * H2_29 + 0.378614950528491 * H2_3 + 0.0850006411525566 * H2_30 + -0.321404253632254 * H2_4 + -0.988288729963278 * H2_5 + -0.627379130426996 * H2_6 + 0.489006663694336 * H2_7 + 1.03647346646568 * H2_8 + -2.04865316528671 * H2_9));
        double H1_4 = tanh((1.61207979958392 + -0.17686449138509 * H2_1 + 0.231861807864425 * H2_10 + 0.078140551508085 * H2_11 + -0.986962845343687 * H2_12 + -0.511158656213082 * H2_13 + 0.363962188598888 * H2_14 + 1.807975359804 * H2_15 + -0.584200526139952 * H2_16 + 2.75891687449737 * H2_17 + 2.75454753491603 * H2_18 + 0.588199278628402 * H2_19 + -1.90979862235528 * H2_2 + -0.0762489760006007 * H2_20 + 0.245889317198701 * H2_21 + -0.175318888402155 * H2_22 + -1.79770399541631 * H2_23 + 0.535351959115994 * H2_24 + 0.980963513562024 * H2_25 + 0.746814301044906 * H2_26 + -0.610435329729627 * H2_27 + -1.18520015158661 * H2_28 + -0.350834264666405 * H2_29 + 0.665950615587447 * H2_3 + -2.46553089202797 * H2_30 + 0.202365097872418 * H2_4 + -2.48368381579887 * H2_5 + 0.321384458661768 * H2_6 + -0.992394671918938 * H2_7 + -0.007001146190302 * H2_8 + -2.65242758388889 * H2_9));
        double H1_5 = tanh((-0.771557590628669 + -0.626601121580536 * H2_1 + 0.235721374174356 * H2_10 + 0.0199631036036387 * H2_11 + -0.159537795389588 * H2_12 + -0.205056523126704 * H2_13 + 1.67009616851707 * H2_14 + -0.156977830699464 * H2_15 + 1.34643829298476 * H2_16 + -1.71445629174116 * H2_17 + 0.0612581160118478 * H2_18 + 0.173689244710989 * H2_19 + -0.201998207975583 * H2_2 + -1.30732277808082 * H2_20 + 1.06100542717845 * H2_21 + 0.672187261470791 * H2_22 + -0.0390815618529497 * H2_23 + 1.66133246683009 * H2_24 + 1.20363023105024 * H2_25 + 2.81394238114847 * H2_26 + 0.499634391106968 * H2_27 + 1.36414130924585 * H2_28 + -0.242179532655794 * H2_29 + 0.544376149560765 * H2_3 + -1.49160199342505 * H2_30 + 1.54189992974541 * H2_4 + 0.971348891181906 * H2_5 + 0.462615221913467 * H2_6 + -1.38884488665862 * H2_7 + 0.680107784617152 * H2_8 + 0.403540162420217 * H2_9));
        double H1_6 = tanh((-0.934468597279486 + 0.0728689147981634 * H2_1 + 0.64000898609063 * H2_10 + 0.175406675480578 * H2_11 + 0.985341188707425 * H2_12 + -0.591057260765716 * H2_13 + 0.0522857452211373 * H2_14 + -1.20340199620813 * H2_15 + 0.50689569129863 * H2_16 + -1.20587290997657 * H2_17 + 0.0445670257992877 * H2_18 + 0.279603985252505 * H2_19 + 1.60801396967829 * H2_2 + 0.804686942480554 * H2_20 + 1.81356123019405 * H2_21 + 0.373973965113233 * H2_22 + 2.13268665639756 * H2_23 + 1.20311648936033 * H2_24 + -1.87942516278496 * H2_25 + -0.985035878720543 * H2_26 + 0.254076064467708 * H2_27 + -0.216450102662938 * H2_28 + 0.138413760209467 * H2_29 + 1.01518752774314 * H2_3 + -0.264713311191766 * H2_30 + 1.08590187298098 * H2_4 + -0.00751045168944703 * H2_5 + 0.602032646465277 * H2_6 + -1.97725785570637 * H2_7 + -1.35973883076301 * H2_8 + 0.289159298106561 * H2_9));
        double H1_7 = tanh((0.1532714637636 + -1.91821395654991 * H2_1 + 0.398948221430279 * H2_10 + -2.41627408926752 * H2_11 + -0.624042196836538 * H2_12 + -0.332044719380654 * H2_13 + -2.25572634681197 * H2_14 + 0.5347465354392 * H2_15 + 0.73679066519168 * H2_16 + -0.465002169913786 * H2_17 + 0.104033009885135 * H2_18 + 0.288576495009141 * H2_19 + -2.65681200878221 * H2_2 + -0.0273301080369014 * H2_20 + -1.39630409106053 * H2_21 + -0.316902888561002 * H2_22 + 1.83705173594563 * H2_23 + -0.151966254160786 * H2_24 + 1.49561779896172 * H2_25 + 1.07802114341013 * H2_26 + -1.48405026108955 * H2_27 + -0.726412275830552 * H2_28 + 1.29586332443911 * H2_29 + -1.50749658766261 * H2_3 + -0.774618724103113 * H2_30 + 0.440147228448016 * H2_4 + 0.645134770122588 * H2_5 + 0.227603047678326 * H2_6 + -0.636052850712271 * H2_7 + 0.403204678484109 * H2_8 + 2.27878147144038 * H2_9));
        double H1_8 = tanh((2.55172366125405 + 1.37368412654336 * H2_1 + -1.44584980716479 * H2_10 + -2.73183094573555 * H2_11 + -1.38440012307958 * H2_12 + 0.880600468809051 * H2_13 + -0.528862404375068 * H2_14 + -1.1727452839992 * H2_15 + -0.242587097473985 * H2_16 + -2.9582831326119 * H2_17 + 0.875952327439234 * H2_18 + -3.07115546771833 * H2_19 + -1.2773464076284 * H2_2 + -2.70190780342894 * H2_20 + 2.01667592945111 * H2_21 + 1.05903354216621 * H2_22 + -1.21203067190775 * H2_23 + -2.18080806420295 * H2_24 + -2.423725007774 * H2_25 + 0.167396631006711 * H2_26 + 0.747093630790408 * H2_27 + -1.27518070007793 * H2_28 + 0.187552203225429 * H2_29 + 0.332752840865 * H2_3 + -0.99204405910639 * H2_30 + 0.586035803739733 * H2_4 + -0.634633066550504 * H2_5 + 1.59753605056867 * H2_6 + -1.65974950850638 * H2_7 + -1.52988899389426 * H2_8 + -0.671621381251975 * H2_9));
        double H1_9 = tanh((0.690935128846883 + 1.40562971496917 * H2_1 + -1.22193406264728 * H2_10 + 1.66566258699793 * H2_11 + -0.930106743607606 * H2_12 + 0.29585352326443 * H2_13 + -0.881209691625159 * H2_14 + -0.536248083716269 * H2_15 + -0.905022740829646 * H2_16 + -1.71291728268934 * H2_17 + -1.59432107838723 * H2_18 + 1.75645183331626 * H2_19 + -1.06416744947975 * H2_2 + -2.2738578344727 * H2_20 + -0.612265740113581 * H2_21 + 1.66294529294045 * H2_22 + 2.41668944755253 * H2_23 + 1.23391904884251 * H2_24 + -0.316586446924519 * H2_25 + -1.30709949909233 * H2_26 + -0.135196476108504 * H2_27 + -0.583312209628032 * H2_28 + -2.78063783533819 * H2_29 + 0.378124197037081 * H2_3 + -0.862148044070631 * H2_30 + 0.600112613853501 * H2_4 + 1.07608006193356 * H2_5 + 1.46939306765256 * H2_6 + -0.718585204164312 * H2_7 + -1.24085470745433 * H2_8 + 1.13290534651519 * H2_9));
        double H1_10 = tanh((2.4120726817492 + -0.587668974683598 * H2_1 + 0.448492499183116 * H2_10 + -0.0250884849442793 * H2_11 + 0.255264438987805 * H2_12 + 0.763390343617485 * H2_13 + 0.899821570586602 * H2_14 + -1.00804019234322 * H2_15 + 0.545347360926933 * H2_16 + 0.985159304666789 * H2_17 + 1.49806661185314 * H2_18 + -0.442636262896451 * H2_19 + 0.43652098199572 * H2_2 + -2.81860550859982 * H2_20 + 1.4671338423201 * H2_21 + 0.182597069954526 * H2_22 + -0.615664087460749 * H2_23 + 2.14531743326085 * H2_24 + -0.289960181281581 * H2_25 + -0.323128569420627 * H2_26 + -0.114236965307974 * H2_27 + -0.466976364682291 * H2_28 + 1.42584593558996 * H2_29 + -0.241092654578949 * H2_3 + -0.247276793408748 * H2_30 + 0.39286673720292 * H2_4 + 1.42126379832192 * H2_5 + -0.326081275307416 * H2_6 + -0.91969902401831 * H2_7 + -0.162571078313906 * H2_8 + -0.393445540276139 * H2_9));
        double H1_11 = tanh((0.536722091124772 + 0.54402779222522 * H2_1 + 2.52984339095309 * H2_10 + 0.0106205221014293 * H2_11 + -0.344272256666076 * H2_12 + -0.331330941379622 * H2_13 + 0.380399386299306 * H2_14 + 1.22357177845454 * H2_15 + 0.143965482349972 * H2_16 + -0.0846035665631388 * H2_17 + 1.02556889646611 * H2_18 + -0.698507917542608 * H2_19 + -1.09962595830617 * H2_2 + 1.0465863454044 * H2_20 + 2.35752868327455 * H2_21 + -0.34505681611433 * H2_22 + -0.698786631989009 * H2_23 + -1.20946259946762 * H2_24 + -0.0860238648334183 * H2_25 + 2.85928187677101 * H2_26 + 1.12576221533522 * H2_27 + 0.0525870475917104 * H2_28 + -0.885677998515701 * H2_29 + -0.528535367452238 * H2_3 + 0.211587285320363 * H2_30 + -1.7449349852305 * H2_4 + 1.19801378831783 * H2_5 + -1.72522250318545 * H2_6 + 2.48120878875029 * H2_7 + -0.346616792778221 * H2_8 + 2.37146878845573 * H2_9));
        double H1_12 = tanh((-0.948607946689643 + 0.26609741146993 * H2_1 + 0.675598826784374 * H2_10 + 1.54545598775644 * H2_11 + -0.843227505205049 * H2_12 + 1.52715575198782 * H2_13 + 1.42709148863679 * H2_14 + -0.0964061665734397 * H2_15 + -1.80706358475102 * H2_16 + -0.350678916739399 * H2_17 + -2.28311548876828 * H2_18 + 0.162098326214508 * H2_19 + -0.957052614512071 * H2_2 + -1.74934612301682 * H2_20 + 0.15053811559823 * H2_21 + 0.0222687364090326 * H2_22 + 0.432814874095949 * H2_23 + 0.171607204353453 * H2_24 + 0.169844200405795 * H2_25 + 1.39611131735523 * H2_26 + 0.0847198112814739 * H2_27 + 0.445367954372929 * H2_28 + -1.07186537684726 * H2_29 + 0.950504743433121 * H2_3 + -1.33754422776103 * H2_30 + -0.261438242853246 * H2_4 + 1.05536999088226 * H2_5 + -0.73350802035585 * H2_6 + 0.25809301675314 * H2_7 + 1.19717651902605 * H2_8 + 0.907465460993139 * H2_9));
        double H1_13 = tanh((-0.975669606617895 + -0.258569526318432 * H2_1 + -0.918095211975085 * H2_10 + -0.601613930132814 * H2_11 + -0.198360690571501 * H2_12 + -0.705953945565254 * H2_13 + 0.298107750843355 * H2_14 + 0.0525039376252618 * H2_15 + 0.778330828004213 * H2_16 + 0.0726341056794363 * H2_17 + 0.0733661970883169 * H2_18 + 0.20022318111093 * H2_19 + 0.453585512405594 * H2_2 + 2.22518478694873 * H2_20 + -0.303804955953578 * H2_21 + -0.435926117908602 * H2_22 + 0.599867564234205 * H2_23 + -1.19007192621452 * H2_24 + 0.276459517661431 * H2_25 + 1.03205564850843 * H2_26 + -0.327571329178938 * H2_27 + -0.177393697799105 * H2_28 + 0.96470995353266 * H2_29 + -0.0295905657608275 * H2_3 + 0.165586945590318 * H2_30 + 0.498416041718469 * H2_4 + -0.597084035156429 * H2_5 + 0.193581384401746 * H2_6 + 1.91473279825068 * H2_7 + 1.82110307171073 * H2_8 + -0.972670273784821 * H2_9));
        double H1_14 = tanh((-2.467770125741 + -0.196410435085279 * H2_1 + -0.0232224354006279 * H2_10 + 2.23508525062065 * H2_11 + -0.184567947363144 * H2_12 + 1.01652007379571 * H2_13 + 1.78071167663575 * H2_14 + -0.397606934949337 * H2_15 + -0.158837791929943 * H2_16 + 0.211990006087144 * H2_17 + -0.562666973469365 * H2_18 + 0.101193476478108 * H2_19 + 1.78171736270493 * H2_2 + -0.777737046257337 * H2_20 + -3.10190363410961 * H2_21 + -0.661506897550303 * H2_22 + -2.45314466990663 * H2_23 + -1.00039905641539 * H2_24 + 0.850336482333815 * H2_25 + -0.754508778811389 * H2_26 + 0.383840470979556 * H2_27 + -0.03895824158954 * H2_28 + -1.76162782737859 * H2_29 + 0.0543740048183484 * H2_3 + 0.38554809543711 * H2_30 + -0.991083170552795 * H2_4 + -0.415800649193437 * H2_5 + 0.591031078365334 * H2_6 + -0.559585682304735 * H2_7 + -0.820811579720172 * H2_8 + -0.0847374480280164 * H2_9));
        double H1_15 = tanh((-2.31931004258629 + 1.13355795339643 * H2_1 + 1.43534514078631 * H2_10 + -0.619609229867625 * H2_11 + -1.59502028779812 * H2_12 + 0.344322387123115 * H2_13 + -1.12123585639231 * H2_14 + -0.714336036201561 * H2_15 + 1.84727885388254 * H2_16 + 0.0662996931994733 * H2_17 + -0.0984635628196626 * H2_18 + -0.716621448258443 * H2_19 + -1.04965422569789 * H2_2 + -1.25102210560896 * H2_20 + -0.356370649746083 * H2_21 + 1.2599236945622 * H2_22 + -0.410382693718214 * H2_23 + -0.713476399792195 * H2_24 + 1.10870794788064 * H2_25 + 1.56388197655913 * H2_26 + 1.65686126117714 * H2_27 + 0.00341334654527552 * H2_28 + -0.512279084513381 * H2_29 + -0.00757495494976028 * H2_3 + -1.7656217370925 * H2_30 + -0.662775043412246 * H2_4 + 0.655355869653259 * H2_5 + -0.174055877610507 * H2_6 + 0.974096582839487 * H2_7 + -1.37651239175312 * H2_8 + -1.97848177680314 * H2_9));
        double H1_16 = tanh((1.70619030754554 + -1.38989743208354 * H2_1 + 0.801411090560175 * H2_10 + -0.550875426122096 * H2_11 + -2.46282351404324 * H2_12 + -1.64455665977496 * H2_13 + 1.0912800704267 * H2_14 + -0.570658624368686 * H2_15 + -1.71023804786521 * H2_16 + -0.105338864597364 * H2_17 + 2.4747644228186 * H2_18 + -0.885582825882689 * H2_19 + -1.49457413714088 * H2_2 + 2.1059202839493 * H2_20 + 0.313076192395144 * H2_21 + 0.953868603839143 * H2_22 + -0.826994268120208 * H2_23 + 1.00440267463297 * H2_24 + 0.172014551541763 * H2_25 + 2.35960015647887 * H2_26 + -0.159387901725332 * H2_27 + -1.28254301416184 * H2_28 + 0.748797761241429 * H2_29 + 0.301293328188279 * H2_3 + 0.113576604747227 * H2_30 + -0.255345125526255 * H2_4 + 0.541897038973527 * H2_5 + -0.954315797154446 * H2_6 + 1.58118876475743 * H2_7 + -0.998644173735353 * H2_8 + -1.48683381912513 * H2_9));
        double H1_17 = tanh((-0.620203410290605 + -0.685363113852246 * H2_1 + -1.468168088481 * H2_10 + 1.29682205289458 * H2_11 + 0.444773885460858 * H2_12 + 0.441367002773323 * H2_13 + -0.272563656631992 * H2_14 + -0.441703346921837 * H2_15 + -0.784590250550437 * H2_16 + -1.1324603970175 * H2_17 + 0.640683622377106 * H2_18 + -1.67593600613687 * H2_19 + 0.987213972669407 * H2_2 + -2.30491877918381 * H2_20 + -3.12065881945437 * H2_21 + 0.962683810814521 * H2_22 + -0.466314381975577 * H2_23 + -0.530721800903837 * H2_24 + 0.86809957607996 * H2_25 + -0.381989490169949 * H2_26 + 1.41533235395052 * H2_27 + -1.89123315231646 * H2_28 + -2.11227626850389 * H2_29 + -0.286829636946516 * H2_3 + -0.857778384864621 * H2_30 + 1.03656115871552 * H2_4 + 1.26483447951995 * H2_5 + 1.58448730137842 * H2_6 + 1.77155951851159 * H2_7 + 0.860264896076611 * H2_8 + 1.63636585260107 * H2_9));
        double H1_18 = tanh((3.36905639355831 + 0.85712501883178 * H2_1 + 0.595853838323885 * H2_10 + -0.379239570326354 * H2_11 + -2.97278565401767 * H2_12 + -0.148205641188508 * H2_13 + -0.318268801812852 * H2_14 + 0.62909945822809 * H2_15 + 0.09920478805891 * H2_16 + -0.145704040386623 * H2_17 + -0.710126912758248 * H2_18 + 0.767863059197778 * H2_19 + -2.19036849279858 * H2_2 + -0.567228437172723 * H2_20 + 0.687194011451686 * H2_21 + 0.448116799423644 * H2_22 + 1.85916336818483 * H2_23 + -1.3686720892757 * H2_24 + 1.33244890668145 * H2_25 + 1.30521617157229 * H2_26 + -0.20190067059925 * H2_27 + 0.839824984760229 * H2_28 + 0.512981274841398 * H2_29 + 0.497700370290571 * H2_3 + -0.838378616006175 * H2_30 + -1.72654144588443 * H2_4 + -1.16164365606717 * H2_5 + -0.354656886558193 * H2_6 + 2.78500559953248 * H2_7 + -0.133919050011497 * H2_8 + -1.72813196511931 * H2_9));
        double H1_19 = tanh((3.29262559511309 + -0.509030978122502 * H2_1 + -0.906401586306455 * H2_10 + -1.29807184111652 * H2_11 + -0.353672424883428 * H2_12 + -0.958959440084166 * H2_13 + -1.3014577414354 * H2_14 + -1.30069232481908 * H2_15 + 1.47055313718935 * H2_16 + -0.0300356991127367 * H2_17 + -1.19746085840259 * H2_18 + -0.380946081627076 * H2_19 + 1.16620279180751 * H2_2 + -0.560315877614455 * H2_20 + 0.979944173845826 * H2_21 + -0.396972576183695 * H2_22 + 0.94378566786684 * H2_23 + 0.633732155953428 * H2_24 + 0.609083619903506 * H2_25 + -0.554706000197299 * H2_26 + 0.256156598792925 * H2_27 + -0.354947968962314 * H2_28 + 1.33339666031797 * H2_29 + 0.742241154330123 * H2_3 + 1.46206870624012 * H2_30 + -1.47250623410687 * H2_4 + 0.325336811008521 * H2_5 + -0.454598736642096 * H2_6 + 1.39108465602184 * H2_7 + 0.124270827674444 * H2_8 + 0.336308857053841 * H2_9));
        double H1_20 = tanh((1.04281593858837 + -2.31271141144068 * H2_1 + -0.246304485586241 * H2_10 + 2.45585924775927 * H2_11 + -0.729661058269506 * H2_12 + -0.0111643049595702 * H2_13 + -0.567428112729426 * H2_14 + 1.97989977013636 * H2_15 + 0.812726560827089 * H2_16 + -1.47237515549375 * H2_17 + 0.00896893158535358 * H2_18 + 0.443026959998251 * H2_19 + -3.89506586377932 * H2_2 + 3.08542653574344 * H2_20 + -2.24105944483618 * H2_21 + 0.299136519988962 * H2_22 + 0.88177653666526 * H2_23 + -0.250009057354451 * H2_24 + -1.54034044316722 * H2_25 + 2.72551719473276 * H2_26 + -0.511038063804475 * H2_27 + 2.88756137269741 * H2_28 + 0.498771861244514 * H2_29 + -0.61926806283474 * H2_3 + -0.198601657597634 * H2_30 + 1.75885343350847 * H2_4 + 1.68558421283826 * H2_5 + 1.05075391973027 * H2_6 + -0.327930184019212 * H2_7 + -0.173199963916761 * H2_8 + 1.65367712518081 * H2_9));
        double H1_21 = tanh((0.520141782223768 + -0.610579851028908 * H2_1 + -0.509106803500603 * H2_10 + 1.2839628413585 * H2_11 + 0.72154919957089 * H2_12 + -0.688241469776919 * H2_13 + -0.759515949464384 * H2_14 + 2.20763304205177 * H2_15 + -0.112554486999733 * H2_16 + 0.606608371573454 * H2_17 + -0.528425769694629 * H2_18 + 0.527080593354006 * H2_19 + 0.585706017597964 * H2_2 + 0.74060294051644 * H2_20 + -1.97467443177196 * H2_21 + -0.314282829665714 * H2_22 + 0.0956128597643186 * H2_23 + 2.08149171014916 * H2_24 + 0.403877984889574 * H2_25 + -0.522766669055967 * H2_26 + 0.980877863463638 * H2_27 + 2.68841061217865 * H2_28 + -1.02110004593942 * H2_29 + -0.575978955673596 * H2_3 + 1.031764833576 * H2_30 + -0.270245975337083 * H2_4 + 0.819679885883408 * H2_5 + -1.56094370293605 * H2_6 + -0.127724754068584 * H2_7 + 0.417367600046297 * H2_8 + -0.341671794041626 * H2_9));
        double H1_22 = tanh((0.638426237816838 + 1.52089672926757 * H2_1 + -2.14980940572392 * H2_10 + -0.546781303946696 * H2_11 + 0.352815161438468 * H2_12 + 0.193345350152176 * H2_13 + -1.98049721649625 * H2_14 + 0.28893873402619 * H2_15 + -0.644851777949008 * H2_16 + 0.283621697460127 * H2_17 + -0.233269881818772 * H2_18 + 0.9262739665589 * H2_19 + -1.36004000617088 * H2_2 + 0.806282532497117 * H2_20 + 0.154235678160936 * H2_21 + -0.695674795681971 * H2_22 + -1.00704294695075 * H2_23 + -1.99347588793382 * H2_24 + -1.2759709504553 * H2_25 + 0.861756884035449 * H2_26 + -0.673087573560046 * H2_27 + -0.970037691894194 * H2_28 + 0.407076359819439 * H2_29 + -0.367044969621825 * H2_3 + -0.668947556619844 * H2_30 + 0.34246877462592 * H2_4 + 1.09064845169368 * H2_5 + 1.43787388729382 * H2_6 + -2.71815968571672 * H2_7 + 1.20493852173887 * H2_8 + 0.58340048551793 * H2_9));
        double H1_23 = tanh((1.3238227722745 + 0.88130250876342 * H2_1 + -0.431932657416939 * H2_10 + -0.0766317537474781 * H2_11 + -2.52707593398733 * H2_12 + 0.941966235449672 * H2_13 + 0.11468449712891 * H2_14 + -2.15012266825349 * H2_15 + 0.152348969500842 * H2_16 + 1.39734112894782 * H2_17 + -0.873244519399734 * H2_18 + -1.01599897040109 * H2_19 + -1.61933931496843 * H2_2 + 0.207503186570095 * H2_20 + 0.238337407785789 * H2_21 + -2.96944342120381 * H2_22 + 0.096824421058193 * H2_23 + 2.92082002143048 * H2_24 + -0.704468000442349 * H2_25 + 0.0822475040769793 * H2_26 + -0.142123817119132 * H2_27 + -3.24855712233538 * H2_28 + -0.933204127591052 * H2_29 + -0.407124895279561 * H2_3 + -0.831268332295897 * H2_30 + 0.827906671052737 * H2_4 + 2.94326507962167 * H2_5 + -0.674818345136361 * H2_6 + 0.667755274138774 * H2_7 + -0.0337606386004261 * H2_8 + 0.291847377066736 * H2_9));
        double H1_24 = tanh((-1.4850667179371 + 0.922184021989957 * H2_1 + 0.632299008022753 * H2_10 + 0.591230126681511 * H2_11 + 0.44626773735596 * H2_12 + -1.07549616474855 * H2_13 + -0.493262196144387 * H2_14 + 0.967555558535593 * H2_15 + 0.107157209787584 * H2_16 + 0.691601767194356 * H2_17 + -0.772755836334909 * H2_18 + 0.779725335605964 * H2_19 + 1.21793465826282 * H2_2 + -0.158442096095677 * H2_20 + -1.72850869867533 * H2_21 + -0.637188860986334 * H2_22 + -0.486338500154495 * H2_23 + -0.512880173877649 * H2_24 + -0.034711240231944 * H2_25 + -0.846011148008173 * H2_26 + 0.642817017641858 * H2_27 + 0.963715622762767 * H2_28 + -0.575882678990382 * H2_29 + 0.4431409047523 * H2_3 + -0.223998443286381 * H2_30 + -1.06367882618169 * H2_4 + 1.06122120563869 * H2_5 + 0.950420674273246 * H2_6 + 0.921812835870725 * H2_7 + -0.527947941107211 * H2_8 + -0.530044714285363 * H2_9));
        double H1_25 = tanh((-1.71530175589744 + 0.904768541821281 * H2_1 + -0.678781819268242 * H2_10 + -0.033483413291356 * H2_11 + 1.60135195686458 * H2_12 + 0.632515437728889 * H2_13 + 0.282658928068295 * H2_14 + -1.37918417349617 * H2_15 + 1.18399066377444 * H2_16 + -0.192079554287709 * H2_17 + 1.50778683010186 * H2_18 + -0.126625549291032 * H2_19 + 1.94091622580926 * H2_2 + 1.9432739531069 * H2_20 + 1.15837097735998 * H2_21 + 0.766640301833014 * H2_22 + -1.62146434298111 * H2_23 + -0.920336746094602 * H2_24 + 0.720836821147253 * H2_25 + -0.71923084051655 * H2_26 + 1.12461275778764 * H2_27 + -2.04872525710295 * H2_28 + 1.10828358615034 * H2_29 + 0.337831808119109 * H2_3 + 2.33846602949397 * H2_30 + 0.689570013771519 * H2_4 + 1.37256030927067 * H2_5 + -0.809281882480474 * H2_6 + 0.967907711957436 * H2_7 + -0.397486376173105 * H2_8 + -2.8862654498684 * H2_9));
        double H1_26 = tanh((-0.878413009966868 + 1.26626782161503 * H2_1 + -2.68167373144402 * H2_10 + 4.19136639565754 * H2_11 + -2.04275647127399 * H2_12 + 1.8294093330413 * H2_13 + -0.612392381042482 * H2_14 + -0.580919312609278 * H2_15 + -2.84445234814694 * H2_16 + 0.525267986203729 * H2_17 + -0.828553528473885 * H2_18 + -1.28214382173591 * H2_19 + -0.145820593885711 * H2_2 + 1.30325284774511 * H2_20 + 2.42797997402757 * H2_21 + -2.70632942437883 * H2_22 + -0.627378927022569 * H2_23 + 0.711579420181834 * H2_24 + -2.33928368076627 * H2_25 + -0.223953083482563 * H2_26 + -1.54915929099099 * H2_27 + 0.00882910807589419 * H2_28 + -0.65525588147816 * H2_29 + 1.78707349261981 * H2_3 + 1.5563294283669 * H2_30 + -1.02061259052035 * H2_4 + 1.50550719878368 * H2_5 + -0.294802410309536 * H2_6 + -1.01055153276755 * H2_7 + 1.20148485111371 * H2_8 + -3.17294096785526 * H2_9));
        double H1_27 = tanh((-1.22738383693982 + 0.195756940085624 * H2_1 + 0.527493365099828 * H2_10 + 0.206708388687266 * H2_11 + -0.884465248503765 * H2_12 + -1.90310337452741 * H2_13 + -0.660085511534477 * H2_14 + 0.85005311585848 * H2_15 + -0.241943400972713 * H2_16 + -1.69557536636569 * H2_17 + -1.00077363079768 * H2_18 + 0.00241971436813518 * H2_19 + -1.53357172353224 * H2_2 + 0.334235117522744 * H2_20 + 0.865594887606988 * H2_21 + -1.4313978426177 * H2_22 + 1.83459787498339 * H2_23 + 1.46520832553595 * H2_24 + 0.0676114591712617 * H2_25 + -0.205436862492139 * H2_26 + -2.27907149464564 * H2_27 + 1.1186736533757 * H2_28 + 0.00513611376920923 * H2_29 + -0.482491779699383 * H2_3 + -0.442713364273084 * H2_30 + 0.306275044440406 * H2_4 + -0.0890648113175234 * H2_5 + 0.165120845590533 * H2_6 + -2.0340277491522 * H2_7 + 0.648395650170909 * H2_8 + 0.0530145947603526 * H2_9));
        double H1_28 = tanh((0.840211369311523 + -1.23626399118466 * H2_1 + -0.823419944626763 * H2_10 + 0.40156617883246 * H2_11 + 0.708635290569703 * H2_12 + 0.432183459634154 * H2_13 + 1.14453723135313 * H2_14 + 0.313607384951711 * H2_15 + -1.27831725056352 * H2_16 + -1.23337717692379 * H2_17 + 0.589690494317744 * H2_18 + -1.27295526749728 * H2_19 + 0.70682454888104 * H2_2 + -0.0487472350130024 * H2_20 + -0.405035716483944 * H2_21 + 0.384317118127704 * H2_22 + 0.0890859475740881 * H2_23 + 3.89700075054235 * H2_24 + 0.339447759801272 * H2_25 + 0.276464008929745 * H2_26 + 0.626790621571022 * H2_27 + -0.137490630819821 * H2_28 + -0.478672293547695 * H2_29 + 0.0476377278985981 * H2_3 + 1.14536545801992 * H2_30 + 0.658410177084926 * H2_4 + 1.70000814057811 * H2_5 + -1.47623217988872 * H2_6 + -0.832623291931266 * H2_7 + 0.0769571149384903 * H2_8 + -0.0960418044241587 * H2_9));
        double H1_29 = tanh((-0.140122426327072 + -0.237556471963737 * H2_1 + -1.77085708388498 * H2_10 + -1.96297919663154 * H2_11 + -2.3884807274157 * H2_12 + -1.24284984027861 * H2_13 + 1.22689308282534 * H2_14 + 0.845800381846368 * H2_15 + -0.025094920364367 * H2_16 + 0.773728757958257 * H2_17 + -0.816631836093053 * H2_18 + -0.324622788134647 * H2_19 + 1.33183380964221 * H2_2 + 0.757815495151549 * H2_20 + -0.290738385782695 * H2_21 + 0.132457473809013 * H2_22 + 3.01424487861287 * H2_23 + 1.42114910385823 * H2_24 + 0.0447509303214337 * H2_25 + 3.09545018487978 * H2_26 + 0.32623138451867 * H2_27 + -0.000705422800568073 * H2_28 + 2.54794321699584 * H2_29 + -1.63332306692684 * H2_3 + -2.73902131032543 * H2_30 + -1.5814783815208 * H2_4 + 2.33020084538674 * H2_5 + 0.427908649764948 * H2_6 + -0.659730753720563 * H2_7 + 1.74785804871796 * H2_8 + 0.446995088349509 * H2_9));
        double H1_30 = tanh((0.156623939159362 + -0.538279019365962 * H2_1 + 0.0134909247755081 * H2_10 + 0.290850139548607 * H2_11 + 0.0149412261067755 * H2_12 + -0.194224024852848 * H2_13 + 0.00766511820596823 * H2_14 + 1.1463967233791 * H2_15 + -1.02612985240356 * H2_16 + 0.5610995450129 * H2_17 + 0.175820957032882 * H2_18 + 0.13997562705249 * H2_19 + 0.950104711925882 * H2_2 + 1.0685191241295 * H2_20 + 1.22960063245442 * H2_21 + 2.45010869721916 * H2_22 + 0.296698698793655 * H2_23 + 1.31009226702107 * H2_24 + 1.18070177489384 * H2_25 + 0.725594875059308 * H2_26 + 0.145929356789022 * H2_27 + -0.595041304637859 * H2_28 + -1.92130861913871 * H2_29 + 0.131063073859566 * H2_3 + -0.410730206766702 * H2_30 + -1.23020626212997 * H2_4 + 1.9090009314058 * H2_5 + -0.245045384403811 * H2_6 + 0.159298236395466 * H2_7 + -0.190226487526786 * H2_8 + -1.59562854570386 * H2_9));

//        er_x = -1.15160052406446*HH1 + -0.571821914711872*HH2 + 4.35133053505011*HH3 + -1.86507662436707*HH4 + 0.0254377957258884*HH5 + 0.464197643348931*HH6 + -0.278751278343659*HH7 + 3.83382327588035*HH8 + 0.605428596091777*HH9 + -1.36237402583453*HH10 + 2.10121714986186*HH11 + 0.531267318321769*HH12 + -0.778493879584163*HH13 + -0.437168870541921*HH14 + 0.505071742625867*HH15 + 1.58750876075436*HH16 + -0.39622968253873*HH17 + -0.228946594748386*HH18 + 0.24898366625183*HH19 + 2.81493467689127*HH20 + -0.258306834697987*HH21 + 0.337843182334052*HH22 + -3.43603071513863*HH23 + 1.25114091616143*HH24 + -0.878117119484174*HH25 + 0.183319048454291*HH26 + -1.6925507906252*HH27 + -2.20284887192058*HH28 + -0.201501175009942*HH29 + 2.17338765567072*HH30 + 9.56825925038303;
//        er_y = 2.61345101711228*HH1 + -0.914962259775394*HH2 + 3.29130220332103*HH3 + -1.78854243649974*HH4 + 1.30985939781439*HH5 + -1.2637669629433*HH6 + -2.42748837017324*HH7 + 1.63268577517429*HH8 + 3.06145950003402*HH9 + -2.69270926584665*HH10 + 1.85351242723307*HH11 + 0.721606628119871*HH12 + -0.202262066202739*HH13 + -0.864478686650681*HH14 + 2.08613648758275*HH15 + 4.97800356970604*HH16 + -6.71059201392259*HH17 + -3.89034829413583*HH18 + -5.42558348831234*HH19 + -2.40900847430784*HH20 + 0.289108964844031*HH21 + -1.39761989623413*HH22 + -8.88766037803032*HH23 + 4.75461341098045*HH24 + -1.1814622894198*HH25 + -0.176663743844998*HH26 + 2.67412425538988*HH27 + -2.67446540907036*HH28 + -0.386303895167799*HH29 + -3.13191085420242*HH30 + 1.05949948956263;
//        er_z = -0.0734046082045102*HH1 + -5.07906498197151*HH2 + -0.0770356119302293*HH3 + 2.18671243302184*HH4 + -3.19093626842145*HH5 + 1.9684721317496*HH6 + 1.13961133686004*HH7 + -5.96558709766418*HH8 + 1.17773725531072*HH9 + -6.36479945158783*HH10 + -4.77567344084101*HH11 + 0.686752118699329*HH12 + 0.0174039249233021*HH13 + 0.787817350619042*HH14 + -0.668288306695955*HH15 + -7.41464174647509*HH16 + -13.1665610288744*HH17 + 2.30783023682174*HH18 + 2.16260266622723*HH19 + -1.15747879737579*HH20 + -1.03386518472945*HH21 + -2.1145648070268*HH22 + -4.42942848601993*HH23 + -8.07405148406398*HH24 + 3.49273929231849*HH25 + 0.112115533555584*HH26 + 2.75340594727628*HH27 + -14.5157886886049*HH28 + -0.607958945681494*HH29 + 5.60350842322126*HH30 + 3.19281885251771;
//        er_ry = -0.119989571260174*HH1 + 2.03392227682266*HH2 + 0.293782151786625*HH3 + -1.3015719636055*HH4 + 0.376694289660232*HH5 + 0.0388078512083435*HH6 + 1.21235371107606*HH7 + 1.20371328311395*HH8 + 1.96403388563557*HH9 + -3.97399876888659*HH10 + -0.0932332828247501*HH11 + -1.56627803488882*HH12 + 1.03976175687446*HH13 + 0.437260580910516*HH14 + -0.370918307927303*HH15 + 1.20540243213106*HH16 + -1.18670939516781*HH17 + -3.84044152123427*HH18 + -1.88925760279667*HH19 + -0.658229844872219*HH20 + -1.07089734098071*HH21 + -2.79531317214252*HH22 + -2.28563447706049*HH23 + 0.736419073276613*HH24 + -1.4031476957427*HH25 + 1.38189756406321*HH26 + 0.240825417402944*HH27 + 0.490600524882784*HH28 + -1.50982752627761*HH29 + -1.74910458412304*HH30 + -2.07102206802369;

        er_x = 6.29867935035128 + 1.18698918389726 * H1_1 + -0.824392125115088 * H1_10 + -0.934653776078337 * H1_11 + 2.12437951392179 * H1_12 + -1.2665108652123 * H1_13 + -1.89646666850842 * H1_14 + -2.09147358949036 * H1_15 + 1.86585196130208 * H1_16 + -0.209825547456308 * H1_17 + -1.60086274338602 * H1_18 + -2.33302495361881 * H1_19 + -0.725030673359396 * H1_2 + -1.14941903040485 * H1_20 + -0.997741073082146 * H1_21 + -3.12372902838992 * H1_22 + -0.0382163066461518 * H1_23 + 2.40564576492327 * H1_24 + 2.11048850501411 * H1_25 + 0.694290230206395 * H1_26 + -0.193916328509616 * H1_27 + -1.53720089876919 * H1_28 + -0.321467694990958 * H1_29 + -0.352614945272073 * H1_3 + -0.353592834927604 * H1_30 + 0.360325323829576 * H1_4 + -0.254166643555445 * H1_5 + 0.00129557016084286 * H1_6 + 1.93706900044602 * H1_7 + 1.16542231216955 * H1_8 + 0.53713665466256 * H1_9;
        er_y = 1.14245496882052 + -2.61092099466261 * H1_1 + -5.09966862335868 * H1_10 + -3.23401230776172 * H1_11 + -1.91755319743023 * H1_12 + -5.51918491791375 * H1_13 + 0.422264877840142 * H1_14 + -1.0409757121851 * H1_15 + -0.803567809689637 * H1_16 + 2.09480114370553 * H1_17 + 7.2090782545268 * H1_18 + 3.69030167226832 * H1_19 + -5.34125268623201 * H1_2 + -1.33006695292347 * H1_20 + -1.27533230950916 * H1_21 + 2.03060654953792 * H1_22 + -0.486955891920614 * H1_23 + 0.494992925517342 * H1_24 + 3.38458102818577 * H1_25 + -2.586454000769 * H1_26 + 3.39563724006838 * H1_27 + 1.5157090118187 * H1_28 + 0.148210796807213 * H1_29 + 0.273204749684414 * H1_3 + -1.86471634887297 * H1_30 + 4.38389742445408 * H1_4 + 1.05721348038507 * H1_5 + -0.138194560097777 * H1_6 + -1.30569568005708 * H1_7 + -1.46489272198196 * H1_8 + -3.97211801703438 * H1_9;
        er_z = 10.1493616206867 + -0.699314027345313 * H1_1 + -1.38233675687964 * H1_10 + -4.25600515833976 * H1_11 + -0.752841477978471 * H1_12 + 1.81064617768348 * H1_13 + -1.3251793404777 * H1_14 + 1.88309374306792 * H1_15 + -1.00188558614938 * H1_16 + -0.355660268013378 * H1_17 + -0.573992832625229 * H1_18 + -1.77911283790244 * H1_19 + 2.61191953332042 * H1_2 + 1.37544354415032 * H1_20 + -0.862327446327846 * H1_21 + -2.7826158430412 * H1_22 + 0.243208732072622 * H1_23 + -0.719309069765174 * H1_24 + 5.8755625459397 * H1_25 + -5.33326086978563 * H1_26 + -3.46850946044026 * H1_27 + 1.84489103498873 * H1_28 + -0.462468147037977 * H1_29 + -4.77585046916809 * H1_3 + 2.07715670440215 * H1_30 + -0.179664519321559 * H1_4 + 1.32448278820203 * H1_5 + -0.217063407679989 * H1_6 + -2.86728440583359 * H1_7 + -8.06237348267139 * H1_8 + -0.710041396668818 * H1_9;
        er_ry = 0.539856966352226 + 0.513134062361172 * H1_1 + -1.12998321447545 * H1_10 + -0.0866870316634915 * H1_11 + 0.259589978270163 * H1_12 + -3.01861502416058 * H1_13 + -1.58774970914706 * H1_14 + -2.33583907181319 * H1_15 + -0.567876082281181 * H1_16 + 1.06229750176474 * H1_17 + 0.959366572866383 * H1_18 + 0.326220571501948 * H1_19 + 0.282498598449791 * H1_2 + -0.574861513373203 * H1_20 + 1.82424709307519 * H1_21 + 0.474098138196793 * H1_22 + 1.15808223440796 * H1_23 + 0.00429234408861406 * H1_24 + -0.0258893410498283 * H1_25 + -1.21711451797849 * H1_26 + -0.0689693145177669 * H1_27 + -0.727012729294216 * H1_28 + -0.0801743553837556 * H1_29 + 2.0553267633269 * H1_3 + -0.889390772870742 * H1_30 + 0.130794725468742 * H1_4 + 0.229081117868275 * H1_5 + 2.52245812999138 * H1_6 + -0.532238769986705 * H1_7 + -1.33570439782683 * H1_8 + -1.12470460541025 * H1_9;
    }

}

void uSystem::stop(){
    system_running = false;
}

void uSystem::run(){
    if(system_running){
        if(mode == detection){
//            cv::imshow("input image", imgInput);
            if(detect_model.Detect(imgInput, net, result)){
                qDebug() << "Size" << result.size();
                detect_model.DrawMaskSingleOnly(imgInput, result[idx], color, system_path.toStdString() + "/" + "result.jpg");

                mask = result[idx].boxMask;
                cv::imwrite(system_path.toStdString() + "\\mask.png", mask);

                if(!system_running){
                    QString result_dir = system_path+ "/" + "result.jpg";
                    QString mask_dir = system_path + "/" + "mask.png";
                    QString mask_bg_dir = system_path + "/" + "mask_bg.png";
                    QFile::remove(result_dir);
                    QFile::remove(mask_dir);
                    QFile::remove(mask_bg_dir);
                    mode = detection;
                    return;
                }
                mode = pose_estimation;
                emit objectDetected();
                return;
            } else{
                if(detect_count == 0){
                    QString result_dir = system_path+ "/" + "result.jpg";
                    QString mask_dir = system_path + "/" + "mask.png";
                    QString mask_bg_dir = system_path + "/" + "mask_bg.png";
                    QFile::remove(result_dir);
                    QFile::remove(mask_dir);
                    QFile::remove(mask_bg_dir);
                    finished = true;
                    system_running = false;
                    emit systemFinished();
                    return;
                } else{
                    detect_count = detect_count - 1;
                    emit requestNewFrame();
                    return;
                }
            }
        } else if(mode == pose_estimation){
            obj_count = obj_count + 1;
            if(obj_count == 0){
                mode = detection;
                emit wrongCalculate();
                return;
            }
            qDebug() << "Count:" << obj_count;

            cv::Mat mask_bg = cv::imread(system_path.toStdString() + "\\mask.png");

            pose_model.createBackground(mask_bg, result[idx].box.x, result[idx].box.y, result[idx].box.width, result[idx].box.height, system_path.toStdString());

            if(!system_running){
                QString result_dir = system_path+ "/" + "result.jpg";
                QString mask_dir = system_path + "/" + "mask.png";
                QString mask_bg_dir = system_path + "/" + "mask_bg.png";
                QFile::remove(result_dir);
                QFile::remove(mask_dir);
                QFile::remove(mask_bg_dir);
                mode = detection;
                return;
            }

            mask_bg = cv::imread(system_path.toStdString() + "\\mask_bg.png");
            std::vector<cv::Point> points;
            double rz = pose_model.run(mask_bg, system_path + "/" + datetime_str, points, obj_count, head_up);

            // If mis-detect
            if(points.size() < 2){
                qDebug() << "Mis-detect";
//                detect_count = detect_count - 1;
                obj_count = obj_count - 1;
                idx = idx + 1;
                if(!(idx <= result.size() - 1)){
                    QString result_dir = system_path+ "/" + "result.jpg";
                    QString mask_dir = system_path + "/" + "mask.png";
                    QString mask_bg_dir = system_path + "/" + "mask_bg.png";
                    QFile::remove(result_dir);
                    QFile::remove(mask_dir);
                    QFile::remove(mask_bg_dir);
                    finished = true;
                    system_running = false;
                    emit systemFinished();
                    return;
                }
                mode = detection;
                emit wrongCalculate();
                return;
            }


            // Find (X,Y,Z) of center point of the object
//            double u_const = double(points[3].x);
//            double v_const = double(points[3].y);
//            double u = double(points[0].x);
//            double v = double(points[0].y);
//            double prev_u, prev_v;
//            int N = 20;
//            for(int i = 0; i < N; i++){
//                if(i == 2){
//                    u_const = prev_u;
//                    v_const = prev_v;
//                }
//                prev_u = u;
//                prev_v = v;
//                u = (prev_u + u_const)/2.0;
//                v = (prev_v + v_const)/2.0;
//            }
            double u = (double(points[4].x) + double(points[3].x))/2.0;
            double v = (double(points[4].y) + double(points[3].y))/2.0;

            qDebug() << "u-v:" << points[0].x << points[0].y;
            qDebug() << "Final u-v:" << u << v;

            double x = (u - intr.ppx)/intr.fx;
            double y = (v - intr.ppy)/intr.fy;
            double z = DepthFrame.get_distance(int(u), int(v))*1000.0;

            x = x*z;
            y = y*z;
            qDebug() << x << y << z;
            if(z < 1.0){
                qDebug() << "Mis-detect";
//                detect_count = detect_count - 1;
                obj_count = obj_count - 1;
                mode = detection;
                emit wrongCalculate();
                return;
            }

            if(!system_running){
                QString result_dir = system_path+ "/" + "result.jpg";
                QString mask_dir = system_path + "/" + "mask.png";
                QString mask_bg_dir = system_path + "/" + "mask_bg.png";
                QFile::remove(result_dir);
                QFile::remove(mask_dir);
                QFile::remove(mask_bg_dir);
                mode = detection;
                return;
            }

            // To get rotation pose of object with respect to camera, every rotation angle must have opposite sign with their true direction through image
            // Point near head
//            double u1 = points[0].x;
//            double v1 = points[0].y;
            double u1 = u;
            double v1 = v;
            double z1 = DepthFrame.get_distance(int(u1), int(v1))*1000.0;

            if(z1 < 1.0){
//                detect_count = detect_count - 1;
                obj_count = obj_count - 1;
                mode = detection;
                emit wrongCalculate();
                return;
            }

            // Point far from head
//            double u2 = (double(points[3].x) + u)/2.0;
//            double v2 = (double(points[3].y) + v)/2.0;
//            double z2 = DepthFrame.get_distance(int(u2), int(v2))*1000.0;

//            if(z2 < 1.0){
//                u2 = double(points[0].x);
//                v2 = double(points[0].y);
//                z2 = DepthFrame.get_distance(int(u2), int(v2))*1000.0;
//            }
            double u2 = (double(points[3].x) + double(points[0].x))/2.0;
            double v2 = (double(points[3].y) + double(points[0].y))/2.0;
            double z2 = DepthFrame.get_distance(int(u2), int(v2))*1000.0;
            if(z2 < 1.0){
//                detect_count = detect_count - 1;
                obj_count = obj_count - 1;
                mode = detection;
                emit wrongCalculate();
                return;
            }



            cv::Mat img2 = cv::imread(system_path.toStdString() + "/" + "result.jpg");
            cv::circle(img2, cv::Point(int(u2), int(v2)), 4, cv::Scalar(180,130,70), 4);
            cv::circle(img2, cv::Point(int(u1), int(v1)), 4, cv::Scalar(180,130,70), 4);
//            cv::circle(img2, cv::Point(int(u), int(v)), 4, cv::Scalar(180,130,70), 4);
            cv::imwrite(system_path.toStdString() + "/" + "result.jpg", img2);

            double l = sqrt(pow(u1 - u2, 2.0) + pow(v1 - v2, 2.0));
//            if(z1 > z2)
//                z1 = z1*1.002;
//            else if(z1 < z2)
//                z2 = z2*1.002;
            qDebug() << "u1-v1-z1:" << u1 << v1 << z1;
            qDebug() << "u2-v2-z2:" << u2 << v2 << z2;
//            if(head_up)
//                ry = atan2(z1 - z2,l)*180.0/M_PI;
//            else
//                ry = atan2(z2 - z1,l)*180.0/M_PI;
            double ry = atan2(abs(z1 - z2),l*(1.0/2.6))*180.0/M_PI;
            if(z1 > z2)
                ry = - ry;

            qDebug() << "ry" << ry;

            if(ry > 50.0 || ry < -50.0){
//                detect_count = detect_count - 1;
                obj_count = obj_count - 1;
                mode = detection;
                emit wrongCalculate();
                return;
            }

            double z_offset = abs(4/sin((90.0 - abs(ry))*M_PI/180.0));
//            if(z_offset > 10.0)
//                z_offset = 10.0;
            qDebug() << "Z offset:" << z_offset;

            if(!system_running){
                QString result_dir = system_path+ "/" + "result.jpg";
                QString mask_dir = system_path + "/" + "mask.png";
                QString mask_bg_dir = system_path + "/" + "mask_bg.png";
                QFile::remove(result_dir);
                QFile::remove(mask_dir);
                QFile::remove(mask_bg_dir);
                mode = detection;
                return;
            }

            int offset_ws_x = 35;
            int offset_ws_y = 30;
            int lower_x = limit_points[0].x + offset_ws_x;
            int upper_x = limit_points[1].x - offset_ws_x;
            int lower_y = limit_points[0].y + offset_ws_y;
            int upper_y = limit_points[3].y - offset_ws_y;

            double rotate_angle = 18.0;
            double rx = 0.0;
            if(!(lower_x < int(u) && int(u) < upper_x && lower_y < int(v) && int(v) < upper_y)){
                qDebug() << "bounded";
                if((0 < rz && rz < 70.0) || (0 > rz && rz > -70.0) || (rz > 110.0) || (rz < -110.0)){
                    if(int(v) < lower_y){
                        qDebug() << "bounded low";
                        if((0 < rz && rz < 70.0) || (0 > rz && rz > -70.0)){
                            qDebug() << "Hi";
//                            if(0 > rz && rz > -70.0)
//                                rx = 0.0 - rotate_angle;   // Rotate to the right
//                            else
//                                rx = 0.0 + rotate_angle;  // Rotate to the left
                            rx = 0.0 + rotate_angle;
                        } else{
//                            if(rz < -110.0){
//                                rx = 0.0 + rotate_angle;  // Rotate to the left
//                            } else{
//                                rx = 0.0 - rotate_angle;   // Rotate to the right
//                            }
                            rx = 0.0 - rotate_angle;
                        }
                    } else if(int(v) > upper_y){
                        qDebug() << "bounded up";
                        if((0 < rz && rz < 70.0) || (0 > rz && rz > -70.0)){
//                            if(0 < rz && rz < 70.0){
//                                rx = 0.0 - rotate_angle;
//                            } else{
//                                rx = 0.0 + rotate_angle;
//                            }
                            rx = 0.0 - rotate_angle;
                        } else{
//                            if(rz > 110.0){
//                                rx = 0.0 + rotate_angle;
//                            } else{
//                                rx = 0.0 - rotate_angle;
//                            }
                            rx = 0.0 + rotate_angle;
                        }
                    } else if(int(u) > upper_x){
                        qDebug() << "bounded right middle";
                        if(!head_up)
                            rx = 0.0 + rotate_angle;
                        else
                            rx = 0.0 - rotate_angle;
                    } else if(int(u) < lower_x){
                        qDebug() << "bounded left middle";
                        if(!head_up)
                            rx = 0.0 - rotate_angle;
                        else
                            rx = 0.0 + rotate_angle;
                    }
                } else if((70 < rz && rz < 110.0) || (-110.0 < rz && rz < -70.0)){
                    if(int(u) < lower_x){
                        qDebug() << "bounded left";
                        if(!head_up)
                            rx = 0.0 - rotate_angle;
                        else
                            rx = 0.0 + rotate_angle;
                    } else if(int(u) > upper_x){
                        qDebug() << "bounded right";
                        if(!head_up)
                            rx = 0.0 + rotate_angle;
                        else
                            rx = 0.0 - rotate_angle;
                    } else if(int(v) < lower_y){
                        qDebug() << "bounded low middle";
                        if((-70.0 > rz && rz > -90.0) || (70.0 < rz && rz < 90.0)){
                            rx = 0.0 + rotate_angle;
                        } else if((90.0 < rz && rz < 110.0) || (-90.0 > rz && rz > -110.0)){
                            rx = 0.0 - rotate_angle;
                        }
                    } else if(int(v) > upper_y){
                        qDebug() << "bounded up middle";
                        if((-90.0 > rz) || (rz < 90.0)){
                            rx = 0.0 - rotate_angle;
                        } else if((90.0 < rz) || (rz > -90.0)){
                            rx = 0.0 + rotate_angle;
                        }
                    }
                }
                z_offset = z_offset + 1.0;
            } else rx = 0.0;

            qDebug() << "Object-to-cam:";
            qDebug() << "xyz:" << x << y << z;
            qDebug() << "rxyz:" << rx << ry << rz;

            qDebug() << "cam-to-base:";
            qDebug() << "xyz:" << calib.x << calib.y << calib.z;
            qDebug() << "rxyz:" << calib.rx << calib.ry << calib.rz;

            // camTbase
            vpRzyxVector bRc_v(calib.rz*M_PI/180.0, calib.ry*M_PI/180.0, calib.rx*M_PI/180.0);
            vpRotationMatrix bRc(bRc_v);
            vpTranslationVector bTc(calib.x/1000.0, calib.y/1000.0, calib.z/1000.0);
            vpHomogeneousMatrix bMc(bTc, bRc);

            // objectTcam
            vpRzyxVector cRo_v(rz*M_PI/180.0, ry*M_PI/180.0, rx*M_PI/180.0);
            vpRotationMatrix cRo(cRo_v);
            vpTranslationVector cTo(x/1000.0, y/1000.0, z/1000.0);
            vpHomogeneousMatrix cMo(cTo, cRo);

            // objectTbase
            vpHomogeneousMatrix bMo = bMc*cMo;
            vpRzyxVector bRo_v(bMo.getRotationMatrix());
            sys_x = bMo[0][3]*1000.0;
            sys_y = bMo[1][3]*1000.0;
            sys_z = bMo[2][3]*1000.0 - z_offset;
            sys_Rx = bRo_v[2]*180.0/M_PI;
            sys_Ry = bRo_v[1]*180.0/M_PI;
            sys_Rz = bRo_v[0]*180.0/M_PI;

            if(sys_z < -150.0){
                qDebug() << "Mis-detect";
//                detect_count = detect_count - 1;
                obj_count = obj_count - 1;
                idx = idx + 1;
                if(!(idx <= result.size() - 1)){
                    QString result_dir = system_path+ "/" + "result.jpg";
                    QString mask_dir = system_path + "/" + "mask.png";
                    QString mask_bg_dir = system_path + "/" + "mask_bg.png";
                    QFile::remove(result_dir);
                    QFile::remove(mask_dir);
                    QFile::remove(mask_bg_dir);
                    finished = true;
                    system_running = false;
                    emit systemFinished();
                    return;
                }
                mode = detection;
                emit wrongCalculate();
                return;
            }

//            if(sys_Rz > 90.0)
//                sys_Rz = sys_Rz - 180.0;
//            else if(sys_Rz < -90.0 )
//                sys_Rz = sys_Rz + 180.0;

            qDebug() << "Object-to-base:";
            qDebug() << "xyz:" << sys_x << sys_y << sys_z;
            qDebug() << "rxyz:" << sys_Rx << sys_Ry << sys_Rz;

            qDebug() << " Calculate error";
            double er_x, er_y, er_z, er_ry;
//            errorEvaluate(x, y, z, rx, ry, rz, er_x, er_y, er_z, er_ry, 1);
//            qDebug() << "Error evaluate x-y-z 1:" <<  er_x << er_y << er_z;
//            errorEvaluate(x, y, z, rx, ry, rz, er_x, er_y, er_z, er_ry, 2);
//            qDebug() << "Error evaluate x-y-z 2:" <<  er_x << er_y << er_z;
            errorEvaluate(x, y, z, rx, ry, rz, er_x, er_y, er_z, er_ry, 3);
            qDebug() << "Error evaluate x-y-z-ry 3:" <<  er_x << er_y << er_z << er_ry;

            if(er_x > 5.0)
                er_x = 5.0;
            else if(er_x < -5.0)
                er_x = -5.0;
            if(er_y > 5.0)
                er_y = 5.0;
            else if(er_y < -5.0)
                er_y = -5.0;

            sys_x = sys_x + er_x;
            sys_y = sys_y - er_y;
//            sys_Ry = sys_Ry - er_ry;

            if(sys_z < -105.5)
                sys_z = -105.5;

            // gripperTbase
            vpRzyxVector bRg_v(sys_Rz*M_PI/180.0, sys_Ry*M_PI/180.0, sys_Rx*M_PI/180.0);
            vpRotationMatrix bRg(bRg_v);
            vpTranslationVector bTg(sys_x/1000.0, sys_y/1000.0, sys_z/1000.0);
            vpHomogeneousMatrix bMg(bTg, bRg);
//            std::cout << "gr " << bMg << std::endl;


            // approachingTgripper
            double dist = -40.0;
            vpRzyxVector gRa_v(0.0*M_PI/180.0, 0.0*M_PI/180.0, 0.0*M_PI/180.0);
            vpRotationMatrix gRa(gRa_v);
            vpTranslationVector gTa(0.0/1000.0, 0.0/1000.0, dist/1000.0);
            vpHomogeneousMatrix gMa(gTa, gRa);
//            std::cout << "ap " << gMa << std::endl;

            // approachingTbase
            vpHomogeneousMatrix bTa = bMg*gMa;
//            std::cout << "final " << bTa << std::endl;
            vpRzyxVector bTa_v(bTa.getRotationMatrix());
            approaching_point.clear();
            approaching_point.append(bTa[0][3]*1000.0);
            approaching_point.append(bTa[1][3]*1000.0);
            approaching_point.append(bTa[2][3]*1000.0);
            approaching_point.append(bTa_v[2]*180.0/M_PI);
            approaching_point.append(bTa_v[1]*180.0/M_PI);
            approaching_point.append(bTa_v[0]*180.0/M_PI);

            // Checking robot reach
            Cartesian moving_point;
            moving_point.x = approaching_point[0];
            moving_point.y = approaching_point[1];
            moving_point.z = approaching_point[2];
            moving_point.rx = approaching_point[3];
            moving_point.ry = approaching_point[4];
            moving_point.rz = approaching_point[5];

            Joint reference_point;
            reference_point.theta[0] = -29.7734;
            reference_point.theta[1] = 22.4358;
            reference_point.theta[2] = 19.132;
            reference_point.theta[3] = 0;
            reference_point.theta[4] = 3.31635;
            reference_point.theta[5] = 29.8795;

            Joint joint_retrieve = robot.motomanInverseKinematics(moving_point, DH, reference_point);
            bool pass = robot.checkPose(joint_retrieve);

            moving_point.x = sys_x;
            moving_point.y = sys_y;
            moving_point.z = sys_z;
            moving_point.rx = sys_Rx;
            moving_point.ry = sys_Ry;
            moving_point.rz = sys_Rz;
            reference_point = joint_retrieve;
            joint_retrieve = robot.motomanInverseKinematics(moving_point, DH, reference_point);
            bool pass2 = robot.checkPose(joint_retrieve);

            mode = detection;
            if(!(pass & pass2)){
                idx = idx + 1;
                if(!(idx <= result.size() - 1)){
                    QString result_dir = system_path+ "/" + "result.jpg";
                    QString mask_dir = system_path + "/" + "mask.png";
                    QString mask_bg_dir = system_path + "/" + "mask_bg.png";
                    QFile::remove(result_dir);
                    QFile::remove(mask_dir);
                    QFile::remove(mask_bg_dir);
                    finished = true;
                    system_running = false;
                    emit systemFinished();
                    return;
                }

//                detect_count = detect_count - 1;
                obj_count = obj_count - 1;
                emit wrongCalculate();
                return;
            }
            idx = 0;

            detect_count = 10;
            emit poseCalculated();
            return;
        }
    }
}
